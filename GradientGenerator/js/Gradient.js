/*
 * CSS Gradient Editor Gradient Database
 */
if(typeof Gradient == "undefined") {var Gradient = {}}
(function(window, document, undefined) {
	"use strict";
	var UltimateWeb2 = {
		name: "Ultimate Web 2.0 Gradients",
		license: 'derived from <a target="_blank" href="http://www.dezinerfolio.com/2007/05/06/ultimate-web-20-layer-styles">' +
			'deziner folio</a>, <a target="_blank" href="http://sglider12.blogspot.com/">SGlider12</a>' +
			' <a target="_blank" href="http://creativecommons.org/licenses/by-sa/2.5/in/">(cc) by-sa</a>',
		gradients: [
			{name: "Blue Gloss Default", stops: [
				{color: "#1E5799", position: "0%"},
				{color: "#2989D8", position: "50%"},
				{color: "#207cca", position: "51%"},
				{color: "#7db9e8", position: "100%"}
			]},
			{name: "Black Gloss #1", stops: [
				{color: "#4c4c4c", position: "0%"},
				{color: "#595959", position: "12%"},
				{color: "#666666", position: "25%"},
				{color: "#474747", position: "39%"},
				{color: "#2c2c2c", position: "50%"},
				{color: "#000000", position: "51%"},
				{color: "#111111", position: "60%"},
				{color: "#2b2b2b", position: "76%"},
				{color: "#1c1c1c", position: "91%"},
				{color: "#131313", position: "100%"}
			]},
			{name: "Blue 3D # 16", stops: [
				{color: "#87e0fd", position: "0%"},
				{color: "#53cbf1", position: "40%"},
				{color: "#05abe0", position: "100%"}
			]},
			{name: "Blue 3D #13", stops: [
				{color: "#f0f9ff", position: "0%"},
				{color: "#cbebff", position: "47%"},
				{color: "#a1dbff", position: "100%"}
			]},
			{name: "Blue 3D #14", stops: [
				{color: "#7abcff", position: "0%"},
				{color: "#60abf8", position: "44%"},
				{color: "#4096ee", position: "100%"}
			]},
			{name: "Blue to Transparent", stops: [
				{color: "#1E5799", position: "0%"},
				{color: "#7db9e8", position: "100%"}
			], opacityStops: [
				{opacity: 1, position: "0%"},
				{opacity: 0, position: "100%"}
			]},
			{name: "Blue to Transparent Sharp", stops: [
				{color: "#1E5799", position: "0%"},
				{color: "#7db9e8", position: "100%"}
			], opacityStops: [
				{opacity: 1, position: "0%"},
				{opacity: 1, position: "62%"},
				{opacity: 0.7, position: "68%"},
				{opacity: 0, position: "100%"}
			]},
			{name: "Blue Two Sided Transparent", stops: [
				{color: "#1E5799", position: "20%"},
				{color: "#2989D8", position: "50%"},
				{color: "#1E5799", position: "80%"}
			], opacityStops: [
				{opacity: 0, position: "0%"},
				{opacity: 0.8, position: "15%"},
				{opacity: 1, position: "19%"},
				{opacity: 1, position: "81%"},
				{opacity: 0.8, position: "85%"},
				{opacity: 0, position: "100%"}
			]},
			{name: "Neutral Density", stops: [
				{color: "#000000", position: "0%"},
				{color: "#000000", position: "100%"}
			], opacityStops: [
				{opacity: "0.65", position: "0%"},
				{opacity: "0", position: "100%"}
			]},
			{name: "White to Transparent", stops: [
				{color: "#ffffff", position: "0%"},
				{color: "#ffffff", position: "100%"}
			], opacityStops: [
				{opacity: "1", position: "0%"},
				{opacity: "0", position: "100%"}
			]},
			{name: "Blue 3D #15", stops: [
				{color: "#00b7ea", position: "0%"},
				{color: "#009ec3", position: "100%"}
			]},
			{name: "Blue 3D #17", stops: [
				{color: "#88bfe8", position: "0%"},
				{color: "#70b0e0", position: "100%"}
			]},
			{name: "Blue 3D #18", stops: [
				{color: "#feffff", position: "0%"},
				{color: "#ddf1f9", position: "35%"},
				{color: "#a0d8ef", position: "100%"}
			]},
			{name: "Blue Flat #1", stops: [
				{color: "#258dc8", position: "0%"},
				{color: "#258dc8", position: "100%"}
			]},
			{name: "Blue Flat #2", stops: [
				{color: "#4096ee", position: "0%"},
				{color: "#4096ee", position: "100%"}
			]},
			{name: "Blue Gloss #1", stops: [
				{color: "#b8e1fc", position: "0%"},
				{color: "#a9d2f3", position: "10%"},
				{color: "#90bae4", position: "25%"},
				{color: "#90bcea", position: "37%"},
				{color: "#90bff0", position: "50%"},
				{color: "#6ba8e5", position: "51%"},
				{color: "#a2daf5", position: "83%"},
				{color: "#bdf3fd", position: "100%"}
			]},
			{name: "Blue Gloss #2", stops: [
				{color: "#3b679e", position: "0%"},
				{color: "#2b88d9", position: "50%"},
				{color: "#207cca", position: "51%"},
				{color: "#7db9e8", position: "100%"}
			]},
			{name: "Blue Gloss #3", stops: [
				{color: "#6db3f2", position: "0%"},
				{color: "#54a3ee", position: "50%"},
				{color: "#3690f0", position: "51%"},
				{color: "#1e69de", position: "100%"}
			]},
			{name: "Blue Gloss #4", stops: [
				{color: "#ebf1f6", position: "0%"},
				{color: "#abd3ee", position: "50%"},
				{color: "#89c3eb", position: "51%"},
				{color: "#d5ebfb", position: "100%"}
			]},
			{name: "Blue Gloss #5", stops: [
				{color: "#e4f5fc", position: "0%"},
				{color: "#bfe8f9", position: "50%"},
				{color: "#9fd8ef", position: "51%"},
				{color: "#2ab0ed", position: "100%"}
			]},
			{name: "Blue Gloss", stops: [
				{color: "#cedbe9", position: "0%"},
				{color: "#aac5de", position: "17%"},
				{color: "#6199c7", position: "50%"},
				{color: "#3a84c3", position: "51%"},
				{color: "#419ad6", position: "59%"},
				{color: "#4bb8f0", position: "71%"},
				{color: "#3a8bc2", position: "84%"},
				{color: "#26558b", position: "100%"}
			]},
			{name: "Blue Grey 3D", stops: [
				{color: "#a7c7dc", position: "0%"},
				{color: "#85b2d3", position: "100%"}
			]},
			{name: "Blue Grey Flat", stops: [
				{color: "#3f4c6b", position: "0%"},
				{color: "#3f4c6b", position: "100%"}
			]},
			{name: "Blue Pipe #1", stops: [
				{color: "#d0e4f7", position: "0%"},
				{color: "#73b1e7", position: "24%"},
				{color: "#0a77d5", position: "50%"},
				{color: "#539fe1", position: "79%"},
				{color: "#87bcea", position: "100%"}
			]},
			{name: "Blue Pipe #2", stops: [
				{color: "#e1ffff", position: "0%"},
				{color: "#e1ffff", position: "7%"},
				{color: "#e1ffff", position: "12%"},
				{color: "#fdffff", position: "12%"},
				{color: "#e6f8fd", position: "30%"},
				{color: "#c8eefb", position: "54%"},
				{color: "#bee4f8", position: "75%"},
				{color: "#b1d8f5", position: "100%"}
			]},
			{name: "Blue Pipe", stops: [
				{color: "#b3dced", position: "0%"},
				{color: "#29b8e5", position: "50%"},
				{color: "#bce0ee", position: "100%"}
			]},
			{name: "Brown 3D", stops: [
				{color: "#d5cea6", position: "0%"},
				{color: "#c9c190", position: "40%"},
				{color: "#b7ad70", position: "100%"}
			]},
			{name: "Brown Gloss", stops: [
				{color: "#f0b7a1", position: "0%"},
				{color: "#8c3310", position: "50%"},
				{color: "#752201", position: "51%"},
				{color: "#bf6e4e", position: "100%"}
			]},
			{name: "Brown Red 3D", stops: [
				{color: "#a90329", position: "0%"},
				{color: "#8f0222", position: "44%"},
				{color: "#6d0019", position: "100%"}
			]},
			{name: "Gold 3D", stops: [
				{color: "#fefcea", position: "0%"},
				{color: "#f1da36", position: "100%"}
			]},
			{name: "Green 3D #1", stops: [
				{color: "#b4ddb4", position: "0%"},
				{color: "#83c783", position: "17%"},
				{color: "#52b152", position: "33%"},
				{color: "#008a00", position: "67%"},
				{color: "#005700", position: "83%"},
				{color: "#002400", position: "100%"}
			]},
			{name: "Green 3D #2", stops: [
				{color: "#cdeb8e", position: "0%"},
				{color: "#a5c956", position: "100%"}
			]},
			{name: "Green 3D #3", stops: [
				{color: "#c9de96", position: "0%"},
				{color: "#8ab66b", position: "44%"},
				{color: "#398235", position: "100%"}
			]},
			{name: "Green 3D #4", stops: [
				{color: "#f8ffe8", position: "0%"},
				{color: "#e3f5ab", position: "33%"},
				{color: "#b7df2d", position: "100%"}
			]},
			{name: "Green 3D #2", stops: [
				{color: "#a9db80", position: "0%"},
				{color: "#96c56f", position: "100%"}
			]},
			{name: "Green 3D", stops: [
				{color: "#b4e391", position: "0%"},
				{color: "#61c419", position: "50%"},
				{color: "#b4e391", position: "100%"}
			]},
			{name: "Green Flat #1", stops: [
				{color: "#299a0b", position: "0%"},
				{color: "#299a0b", position: "100%"}
			]},
			{name: "Green Flat #2", stops: [
				{color: "#8fc800", position: "0%"},
				{color: "#8fc800", position: "100%"}
			]},
			{name: "Green Flat #3", stops: [
				{color: "#006e2e", position: "0%"},
				{color: "#006e2e", position: "100%"}
			]},
			{name: "Green Flat #4", stops: [
				{color: "#6bba70", position: "0%"},
				{color: "#6bba70", position: "100%"}
			]},
			{name: "Green Flat #5", stops: [
				{color: "#cdeb8b", position: "0%"},
				{color: "#cdeb8b", position: "100%"}
			]},
			{name: "Green Flat #6", stops: [
				{color: "#8fc400", position: "0%"},
				{color: "#8fc400", position: "100%"}
			]},
			{name: "Green Flat", stops: [
				{color: "#b6e026", position: "0%"},
				{color: "#abdc28", position: "100%"}
			]},
			{name: "Green Gloss #1", stops: [
				{color: "#9dd53a", position: "0%"},
				{color: "#a1d54f", position: "50%"},
				{color: "#80c217", position: "51%"},
				{color: "#7cbc0a", position: "100%"}
			]},
			{name: "Green Gloss #2", stops: [
				{color: "#e6f0a3", position: "0%"},
				{color: "#d2e638", position: "50%"},
				{color: "#c3d825", position: "51%"},
				{color: "#dbf043", position: "100%"}
			]},
			{name: "Green Gloss", stops: [
				{color: "#bfd255", position: "0%"},
				{color: "#8eb92a", position: "50%"},
				{color: "#72aa00", position: "51%"},
				{color: "#9ecb2d", position: "100%"}
			]},
			{name: "Green Semi Flat", stops: [
				{color: "#b4df5b", position: "0%"},
				{color: "#b4df5b", position: "100%"}
			]},
			{name: "Gren 3D", stops: [
				{color: "#eeeeee", position: "0%"},
				{color: "#cccccc", position: "100%"}
			]},
			{name: "Grey 3D #1", stops: [
				{color: "#cedce7", position: "0%"},
				{color: "#596a72", position: "100%"}
			]},
			{name: "Grey 3D #2", stops: [
				{color: "#606c88", position: "0%"},
				{color: "#3f4c6b", position: "100%"}
			]},
			{name: "Grey 3D #3", stops: [
				{color: "#b0d4e3", position: "0%"},
				{color: "#88bacf", position: "100%"}
			]},
			{name: "Grey 3D #4", stops: [
				{color: "#f2f5f6", position: "0%"},
				{color: "#e3eaed", position: "37%"},
				{color: "#c8d7dc", position: "100%"}
			]},
			{name: "Grey 3D", stops: [
				{color: "#d8e0de", position: "0%"},
				{color: "#aebfbc", position: "22%"},
				{color: "#99afab", position: "33%"},
				{color: "#8ea6a2", position: "50%"},
				{color: "#829d98", position: "67%"},
				{color: "#4e5c5a", position: "82%"},
				{color: "#0e0e0e", position: "100%"}
			]},
			{name: "Grey Black 3D", stops: [
				{color: "#b5bdc8", position: "0%"},
				{color: "#828c95", position: "36%"},
				{color: "#28343b", position: "100%"}
			]},
			{name: "Grey Blue 3D #1", stops: [
				{color: "#b8c6df", position: "0%"},
				{color: "#6d88b7", position: "100%"}
			]},
			{name: "Grey Blue 3D", stops: [
				{color: "#cfe7fa", position: "0%"},
				{color: "#6393c1", position: "100%"}
			]},
			{name: "Grey Blue Gloss #1", stops: [
				{color: "#d2dfed", position: "0%"},
				{color: "#c8d7eb", position: "26%"},
				{color: "#bed0ea", position: "51%"},
				{color: "#a6c0e3", position: "51%"},
				{color: "#afc7e8", position: "62%"},
				{color: "#bad0ef", position: "75%"},
				{color: "#99b5db", position: "88%"},
				{color: "#799bc8", position: "100%"}
			]},
			{name: "Grey Flat", stops: [
				{color: "#eeeeee", position: "0%"},
				{color: "#eeeeee", position: "100%"}
			]},
			{name: "Grey Gloss #1", stops: [
				{color: "#e2e2e2", position: "0%"},
				{color: "#dbdbdb", position: "50%"},
				{color: "#d1d1d1", position: "51%"},
				{color: "#fefefe", position: "100%"}
			]},
			{name: "Grey Gloss #2", stops: [
				{color: "#f2f6f8", position: "0%"},
				{color: "#d8e1e7", position: "50%"},
				{color: "#b5c6d0", position: "51%"},
				{color: "#e0eff9", position: "100%"}
			]},
			{name: "Grey Gloss", stops: [
				{color: "#d4e4ef", position: "0%"},
				{color: "#86aecc", position: "100%"}
			]},
			{name: "Grey Pipe", stops: [
				{color: "#f5f6f6", position: "0%"},
				{color: "#dbdce2", position: "21%"},
				{color: "#b8bac6", position: "49%"},
				{color: "#dddfe3", position: "80%"},
				{color: "#f5f6f6", position: "100%"}
			]},
			{name: "L Brown 3D", stops: [
				{color: "#f3e2c7", position: "0%"},
				{color: "#c19e67", position: "50%"},
				{color: "#b68d4c", position: "51%"},
				{color: "#e9d4b3", position: "100%"}
			]},
			{name: "L Green 3D", stops: [
				{color: "#f9fcf7", position: "0%"},
				{color: "#f5f9f0", position: "100%"}
			]},
			{name: "Lavender 3D", stops: [
				{color: "#c3d9ff", position: "0%"},
				{color: "#b1c8ef", position: "41%"},
				{color: "#98b0d9", position: "100%"}
			]},
			{name: "Neon", stops: [
				{color: "#d2ff52", position: "0%"},
				{color: "#91e842", position: "100%"}
			]},
			{name: "Olive 3D #1", stops: [
				{color: "#fefefd", position: "0%"},
				{color: "#dce3c4", position: "42%"},
				{color: "#aebf76", position: "100%"}
			]},
			{name: "Olive 3D #2", stops: [
				{color: "#e4efc0", position: "0%"},
				{color: "#abbd73", position: "100%"}
			]},
			{name: "Olive 3D #3", stops: [
				{color: "#a4b357", position: "0%"},
				{color: "#75890c", position: "100%"}
			]},
			{name: "Olive 3D", stops: [
				{color: "#627d4d", position: "0%"},
				{color: "#1f3b08", position: "100%"}
			]},
			{name: "Olive Flat", stops: [
				{color: "#73880a", position: "0%"},
				{color: "#73880a", position: "100%"}
			]},
			{name: "Orange 3D #1", stops: [
				{color: "#ffaf4b", position: "0%"},
				{color: "#ff920a", position: "100%"}
			]},
			{name: "Orange 3D #2", stops: [
				{color: "#fac695", position: "0%"},
				{color: "#f5ab66", position: "47%"},
				{color: "#ef8d31", position: "100%"}
			]},
			{name: "Orange 3D #3", stops: [
				{color: "#ffc578", position: "0%"},
				{color: "#fb9d23", position: "100%"}
			]},
			{name: "Orange 3D #4", stops: [
				{color: "#f9c667", position: "0%"},
				{color: "#f79621", position: "100%"}
			]},
			{name: "Orange 3D #5", stops: [
				{color: "#fceabb", position: "0%"},
				{color: "#fccd4d", position: "50%"},
				{color: "#f8b500", position: "51%"},
				{color: "#fbdf93", position: "100%"}
			]},
			{name: "Orange 3D", stops: [
				{color: "#ffa84c", position: "0%"},
				{color: "#ff7b0d", position: "100%"}
			]},
			{name: "Orange Flat #1", stops: [
				{color: "#ff670f", position: "0%"},
				{color: "#ff670f", position: "100%"}
			]},
			{name: "Orange Flat", stops: [
				{color: "#ff7400", position: "0%"},
				{color: "#ff7400", position: "100%"}
			]},
			{name: "Orange Gloss", stops: [
				{color: "#ffb76b", position: "0%"},
				{color: "#ffa73d", position: "50%"},
				{color: "#ff7c00", position: "51%"},
				{color: "#ff7f04", position: "100%"}
			]},
			{name: "Pink 3D #1", stops: [
				{color: "#ff5db1", position: "0%"},
				{color: "#ef017c", position: "100%"}
			]},
			{name: "Pink 3D #2", stops: [
				{color: "#fb83fa", position: "0%"},
				{color: "#e93cec", position: "100%"}
			]},
			{name: "Pink 3D #3", stops: [
				{color: "#e570e7", position: "0%"},
				{color: "#c85ec7", position: "47%"},
				{color: "#a849a3", position: "100%"}
			]},
			{name: "Pink 3D", stops: [
				{color: "#cb60b3", position: "0%"},
				{color: "#ad1283", position: "50%"},
				{color: "#de47ac", position: "100%"}
			]},
			{name: "Pink Flat", stops: [
				{color: "#ff0084", position: "0%"},
				{color: "#ff0084", position: "100%"}
			]},
			{name: "Pink Gloss #2", stops: [
				{color: "#fcecfc", position: "0%"},
				{color: "#fba6e1", position: "50%"},
				{color: "#fd89d7", position: "51%"},
				{color: "#ff7cd8", position: "100%"}
			]},
			{name: "Pink Gloss", stops: [
				{color: "#cb60b3", position: "0%"},
				{color: "#c146a1", position: "50%"},
				{color: "#a80077", position: "51%"},
				{color: "#db36a4", position: "100%"}
			]},
			{name: "Purple 3D #1", stops: [
				{color: "#ebe9f9", position: "0%"},
				{color: "#d8d0ef", position: "50%"},
				{color: "#cec7ec", position: "51%"},
				{color: "#c1bfea", position: "100%"}
			]},
			{name: "Purple 3D", stops: [
				{color: "#8989ba", position: "0%"},
				{color: "#8989ba", position: "100%"}
			]},
			{name: "Red 3D #1", stops: [
				{color: "#febbbb", position: "0%"},
				{color: "#fe9090", position: "45%"},
				{color: "#ff5c5c", position: "100%"}
			]},
			{name: "Red 3D #2", stops: [
				{color: "#f2825b", position: "0%"},
				{color: "#e55b2b", position: "50%"},
				{color: "#f07146", position: "100%"}
			]},
			{name: "Red 3D", stops: [
				{color: "#ff3019", position: "0%"},
				{color: "#cf0404", position: "100%"}
			]},
			{name: "Red Flat #1", stops: [
				{color: "#ff1a00", position: "0%"},
				{color: "#ff1a00", position: "100%"}
			]},
			{name: "Red Flat", stops: [
				{color: "#cc0000", position: "0%"},
				{color: "#cc0000", position: "100%"}
			]},
			{name: "Red Gloss #1", stops: [
				{color: "#f85032", position: "0%"},
				{color: "#f16f5c", position: "50%"},
				{color: "#f6290c", position: "51%"},
				{color: "#f02f17", position: "71%"},
				{color: "#e73827", position: "100%"}
			]},
			{name: "Red Gloss #2", stops: [
				{color: "#feccb1", position: "0%"},
				{color: "#f17432", position: "50%"},
				{color: "#ea5507", position: "51%"},
				{color: "#fb955e", position: "100%"}
			]},
			{name: "Red Gloss #3", stops: [
				{color: "#efc5ca", position: "0%"},
				{color: "#d24b5a", position: "50%"},
				{color: "#ba2737", position: "51%"},
				{color: "#f18e99", position: "100%"}
			]},
			{name: "Red Gloss", stops: [
				{color: "#f3c5bd", position: "0%"},
				{color: "#e86c57", position: "50%"},
				{color: "#ea2803", position: "51%"},
				{color: "#ff6600", position: "75%"},
				{color: "#c72200", position: "100%"}
			]},
			{name: "Shape 1 Style", stops: [
				{color: "#b7deed", position: "0%"},
				{color: "#71ceef", position: "50%"},
				{color: "#21b4e2", position: "51%"},
				{color: "#b7deed", position: "100%"}
			]},
			{name: "Shape 2 Style", stops: [
				{color: "#e0f3fa", position: "0%"},
				{color: "#d8f0fc", position: "50%"},
				{color: "#b8e2f6", position: "51%"},
				{color: "#b6dffd", position: "100%"}
			]},
			{name: "Wax 3D #1", stops: [
				{color: "#feffe8", position: "0%"},
				{color: "#d6dbbf", position: "100%"}
			]},
			{name: "Wax 3D #2", stops: [
				{color: "#fcfff4", position: "0%"},
				{color: "#e9e9ce", position: "100%"}
			]},
			{name: "Wax 3D #3", stops: [
				{color: "#fcfff4", position: "0%"},
				{color: "#dfe5d7", position: "40%"},
				{color: "#b3bead", position: "100%"}
			]},
			{name: "Wax 3D", stops: [
				{color: "#e5e696", position: "0%"},
				{color: "#d1d360", position: "100%"}
			]},
			{name: "Wax Flat", stops: [
				{color: "#eaefb5", position: "0%"},
				{color: "#e1e9a0", position: "100%"}
			]},
			{name: "Black 3D #1", stops: [
				{color: "#45484d", position: "0%"},
				{color: "#000000", position: "100%"}
			]},
			{name: "Black 3D", stops: [
				{color: "#7d7e7d", position: "0%"},
				{color: "#0e0e0e", position: "100%"}
			]},
			{name: "Black Gloss Pipe", stops: [
				{color: "#959595", position: "0%"},
				{color: "#0d0d0d", position: "46%"},
				{color: "#010101", position: "50%"},
				{color: "#0a0a0a", position: "53%"},
				{color: "#4e4e4e", position: "76%"},
				{color: "#383838", position: "87%"},
				{color: "#1b1b1b", position: "100%"}
			]},
			{name: "Black Gloss", stops: [
				{color: "#aebcbf", position: "0%"},
				{color: "#6e7774", position: "50%"},
				{color: "#0a0e0a", position: "51%"},
				{color: "#0a0809", position: "100%"}
			]},
			{name: "Web 2.0 Blue 3D #1", stops: [
				{color: "#c5deea", position: "0%"},
				{color: "#8abbd7", position: "31%"},
				{color: "#066dab", position: "100%"}
			]},
			{name: "Blue 3D #1", stops: [
				{color: "#f7fbfc", position: "0%"},
				{color: "#d9edf2", position: "40%"},
				{color: "#add9e4", position: "100%"}
			]},
			{name: "Blue 3D", stops: [
				{color: "#d6f9ff", position: "0%"},
				{color: "#9ee8fa", position: "100%"}
			]},
			{name: "Blue 3D #3", stops: [
				{color: "#e9f6fd", position: "0%"},
				{color: "#d3eefb", position: "100%"}
			]},
			{name: "Blue 3D #4", stops: [
				{color: "#63b6db", position: "0%"},
				{color: "#309dcf", position: "100%"}
			]},
			{name: "Blue 3D #2", stops: [
				{color: "#2c539e", position: "0%"},
				{color: "#2c539e", position: "100%"}
			]},
			{name: "Ble 3D #5", stops: [
				{color: "#a9e4f7", position: "0%"},
				{color: "#0fb4e7", position: "100%"}
			]},
			{name: "Blue 3D #5", stops: [
				{color: "#93cede", position: "0%"},
				{color: "#75bdd1", position: "41%"},
				{color: "#49a5bf", position: "100%"}
			]},
			{name: "Blue 3D #6", stops: [
				{color: "#b2e1ff", position: "0%"},
				{color: "#66b6fc", position: "100%"}
			]},
			{name: "Blue 3D #9", stops: [
				{color: "#4f85bb", position: "0%"},
				{color: "#4f85bb", position: "100%"}
			]},
			{name: "Blue 3D #10", stops: [
				{color: "#deefff", position: "0%"},
				{color: "#98bede", position: "100%"}
			]},
			{name: "Blue 3D #11", stops: [
				{color: "#49c0f0", position: "0%"},
				{color: "#2cafe3", position: "100%"}
			]},
			{name: "Blue 3D #12", stops: [
				{color: "#feffff", position: "0%"},
				{color: "#d2ebf9", position: "100%"}
			]},
			{name: "Blue 3d #8", stops: [
				{color: "#a7cfdf", position: "0%"},
				{color: "#23538a", position: "100%"}
			]},
			{name: "Blue 3d #7", stops: [
				{color: "#499bea", position: "0%"},
				{color: "#207ce5", position: "100%"}
			]},
			{name: "Blue Flat", stops: [
				{color: "#356aa0", position: "0%"},
				{color: "#356aa0", position: "100%"}
			]},
			{name: "White 3D #1", stops: [
				{color: "#ffffff", position: "0%"},
				{color: "#f6f6f6", position: "47%"},
				{color: "#ededed", position: "100%"}
			]},
			{name: "White 3D #2", stops: [
				{color: "#f2f9fe", position: "0%"},
				{color: "#d6f0fd", position: "100%"}
			]},
			{name: "White 3D", stops: [
				{color: "#ffffff", position: "0%"},
				{color: "#e5e5e5", position: "100%"}
			]},
			{name: "White Gloss #1", stops: [
				{color: "#ffffff", position: "0%"},
				{color: "#f1f1f1", position: "50%"},
				{color: "#e1e1e1", position: "51%"},
				{color: "#f6f6f6", position: "100%"}
			]},
			{name: "White Gloss #2", stops: [
				{color: "#ffffff", position: "0%"},
				{color: "#f3f3f3", position: "50%"},
				{color: "#ededed", position: "51%"},
				{color: "#ffffff", position: "100%"}
			]},
			{name: "White Gloss", stops: [
				{color: "#f6f8f9", position: "0%"},
				{color: "#e5ebee", position: "50%"},
				{color: "#d7dee3", position: "51%"},
				{color: "#f5f7f9", position: "100%"}
			]},
			{name: "Yellow 3D #1", stops: [
				{color: "#f6e6b4", position: "0%"},
				{color: "#ed9017", position: "100%"}
			]},
			{name: "Yellow 3D #2", stops: [
				{color: "#eab92d", position: "0%"},
				{color: "#c79810", position: "100%"}
			]},
			{name: "Yellow 3D #2", stops: [
				{color: "#ffd65e", position: "0%"},
				{color: "#febf04", position: "100%"}
			]},
			{name: "Yellow 3D", stops: [
				{color: "#f1e767", position: "0%"},
				{color: "#feb645", position: "100%"}
			]},
			{name: "Yellow Flat #1", stops: [
				{color: "#ffff88", position: "0%"},
				{color: "#ffff88", position: "100%"}
			]},
			{name: "Yellow Flat", stops: [
				{color: "#febf01", position: "0%"},
				{color: "#febf01", position: "100%"}
			]}
		]
	};
	Gradient.DB = {Default: UltimateWeb2, UltimateWeb2: UltimateWeb2};
	/*

	 CSS Gradient Editor

	 Written by Alex Sirota (alex @ iosart.com)

	 Copyright (c) Alex Sirota 2010, All Rights Reserved

	 Please do not use without permission

	 */

	Gradient.Editor = function(elenemtID) {
		var _this = this;
		if(navigator.appVersion.indexOf("Mac") != -1) {$$("body")[0].addClassName("macos")}
		this.gradientControl = $(elenemtID);
		this.gradientPanelElem = this.gradientControl.select(".gradient-panel")[0];
		this.gradientMarkersContainerElem = this.gradientControl.select(".stop-markers-color")[0];
		this.gradientMarkerDeleterElem = this.gradientControl.select(".stop-markers-color-deleter")[0];
		this.stopDetailsPanel = this.gradientControl.select(".stop-details-color")[0];
		var g = {
			gradientEditor: this,
			gradientControl: this.gradientControl,
			gradientPanelElem: this.gradientPanelElem,
			gradientMarkersContainerElem: this.gradientMarkersContainerElem,
			gradientMarkerDeleterElem: this.gradientMarkerDeleterElem,
			stopDetailsPanel: this.stopDetailsPanel,
			onStopActivatedCallback: this.onStopActivated.bind(this)
		};
		this.colorStopsHandler = new Gradient.StopsHandler("color", g);
		this.gradientOpacityMarkersContainerElem = this.gradientControl.select(".stop-markers-opacity")[0];
		this.gradientOpacityMarkerDeleterElem = this.gradientControl.select(".stop-markers-opacity-deleter")[0];
		this.opacityStopDetailsPanel = this.gradientControl.select(".stop-details-opacity")[0];
		var g = {
			gradientEditor: this,
			gradientControl: this.gradientControl,
			gradientPanelElem: this.gradientPanelElem,
			gradientMarkersContainerElem: this.gradientOpacityMarkersContainerElem,
			gradientMarkerDeleterElem: this.gradientOpacityMarkerDeleterElem,
			stopDetailsPanel: this.opacityStopDetailsPanel,
			onStopActivatedCallback: this.onStopActivated.bind(this)
		};
		this.opacityStopsHandler = new Gradient.StopsHandler("opacity", g);
		this.cssTextElem = this.gradientControl.select(".css-output-text")[0];
		this.cssCopyButtonContainerElem = this.gradientControl.select(".copy-button-container")[0];
		this.cssCopyButtonElem = this.cssCopyButtonContainerElem.select(".copy-button")[0];
		this.cssCopyStatusElem = this.gradientControl.select(".copy-status")[0];
		this.cssNotesElem = this.gradientControl.select(".css-notes")[0];
		this.cssNotesTextElem = this.cssNotesElem.select(".css-notes-text")[0];
		this.cssNotesCloseButton = this.cssNotesElem.select(".small-close-button")[0];
		this.cssNotesCloseButton.observe("click", function() {_this.cssNotesElem.hide()});
		this.currentOutputFormatElem = this.gradientControl.select(".current-output-format")[0];
		this.switchOutputFormatElem = this.gradientControl.select(".switch-output-format")[0];
		this.previewBackgroundElem = this.gradientControl.select(".preview-panel-background")[0];
		this.previewElem = this.gradientControl.select(".preview-panel")[0];
		this.previewHandleElem = this.gradientControl.select(".preview-panel-handle")[0];
		this.orientationSelectorElem = this.gradientControl.select(".output-options .orientation")[0];
		this.previewDimensionWidthElem = this.gradientControl.select(".output-options .dimension-width")[0];
		this.previewDimensionHeightElem = this.gradientControl.select(".output-options .dimension-height")[0];
		this.previewAsIECheckboxElem = this.gradientControl.select(".output-options input.preview-as-ie")[0];
		this.presetsContainerElem = this.gradientControl.select(".presets .presets-container")[0];
		this.gradientNameBoxElem = this.gradientControl.select(".gradient-name .name-input")[0];
		this.saveNewPresetButtonElem = this.gradientControl.select(".gradient-name .save-new-preset")[0];
		function a(i, h) {
			_this.previewDimensionsWidth = i - 2;
			_this.previewDimensionsHeight = h - 2;
			_this.previewDimensionWidthElem.value = _this.previewDimensionsWidth;
			_this.previewDimensionHeightElem.value = _this.previewDimensionsHeight;
			ColorZilla.Persist.set("preview-width", _this.previewDimensionsWidth);
			ColorZilla.Persist.set("preview-height", _this.previewDimensionsHeight)
		}

		Gradient.UIUtils.makeResizable(this.previewBackgroundElem, this.previewHandleElem, a);
		this.colorFormatSelectorElem = this.gradientControl.select(".css-options .color-format")[0];
		this.includeCSSCommentsCheckboxElem = this.gradientControl.select(".css-options input#css-comments")[0];
		this.supportIE9CheckboxElem = this.gradientControl.select(".css-options input#css-ie9-support")[0];
		this.supportIE9HelpElem = this.gradientControl.select(".css-options .css-ie9-support-help a")[0];
		this.colorPickerElem = $("colorpicker-1");
		this.gradientPanelElemWidth = Element.getWidth(this.gradientPanelElem);
		this.gradientPanelElemWidth -= 2;
		this.cssTextElem.observe("dblclick", function() {Gradient.Utils.selectTextInNode(_this.cssTextElem)});
		this.orientationSelectorElem.observe("change", this.onOrientationSelectorChange.bind(this));
		this.previewDimensionWidthElem.observe("change", this.onPreviewDimensionsChange.bind(this));
		this.previewDimensionHeightElem.observe("change", this.onPreviewDimensionsChange.bind(this));
		this.previewAsIECheckboxElem.observe("change", this.onPreviewAsIECheckboxChange.bind(this));
		this.colorFormatSelectorElem.observe("change", this.onColorFormatSelectorChange.bind(this));
		this.includeCSSCommentsCheckboxElem.observe("change", this.onIncludeCSSCommentsCheckboxChange.bind(this));
		this.saveNewPresetButtonElem.observe("click", this.onSaveNewPresetButtonClick.bind(this));
		this.supportIE9CheckboxElem.observe("change", this.onSupportIE9CheckboxChange.bind(this));
		this.supportIE9HelpElem.observe("click", function(h) {
			Event.stop(h);
			_this.showIE9SupportInstructions()
		});
		this.importFromCSSButton = this.gradientControl.select("button.import-css")[0];
		this.importFromCSSButton.observe("click", this.onImportFromCSSButtonClicked.bind(this));
		this.importFromCSSPanel = this.gradientControl.select(".import-css-input-panel")[0];
		this.importFromCSSPanelOkButton = this.gradientControl.select(".import-css-input-panel button.ok")[0];
		this.importFromCSSPanelOkButton.observe("click", this.onImportFromCSSPanelOkButtonClick.bind(this));
		this.importFromCSSPanelCancelButton = this.gradientControl.select(".import-css-input-panel button.cancel")[0];
		this.importFromCSSPanelCancelButton.observe("click", this.onImportFromCSSPanelCancelButtonClick.bind(this));
		this.importFromCSSTextElem = this.gradientControl.select(".import-css-input-panel .import-css-text")[0];
		this.importFromImageButton = this.gradientControl.select("button.import-image")[0];
		this.importFromImageButton.observe("click", this.onImportFromImageButtonClicked.bind(this));
		this.importFromImagePanel = this.gradientControl.select(".import-image-input-panel")[0];
		this.importFromImageForm = this.gradientControl.select(".import-image-form")[0];
		this.importFromImagePanelOkButton = this.gradientControl.select(".import-image-input-panel button.ok")[0];
		this.importFromImagePanelOkButton.observe("click", this.onImportFromImagePanelOkButtonClick.bind(this));
		this.importFromImagePanelCancelButton = this.gradientControl.select(".import-image-input-panel button.cancel")[0];
		this.importFromImagePanelCancelButton.observe("click", this.onImportFromImagePanelCancelButtonClick.bind(this));
		this.importFromImageFileInputElem = this.gradientControl.select(".import-image-input-panel input.import-image-file-input")[0];
		this.importFromImageURLInputElem = this.gradientControl.select(".import-image-input-panel input.import-image-url-input")[0];
		this.switchOutputFormatElem.observe("click", this.onSwitchOutputFormatClicked.bind(this));
		this.permalinkElem = this.gradientControl.select(".permalink-panel .permalink")[0];
		this.cssImporter = null;
		this.lastUsedColor = "#ffffff";
		this.outputOrientation = ColorZilla.Persist.get("output-orientation", "vertical");
		this.orientationSelectorElem.value = this.outputOrientation;
		this.previewDimensionsWidth = ColorZilla.Persist.get("preview-width", "370");
		this.previewDimensionsHeight = ColorZilla.Persist.get("preview-height", "50");
		this.previewDimensionWidthElem.value = this.previewDimensionsWidth;
		this.previewDimensionHeightElem.value = this.previewDimensionsHeight;
		this.previewAsIE = false;
		this.cssColorFormat = ColorZilla.Persist.get("css-color-format", "hex");
		this.colorFormatSelectorElem.value = this.cssColorFormat;
		this.includeCSSComments = (ColorZilla.Persist.get("include-css-comments", "true") == "true");
		this.includeCSSCommentsCheckboxElem.checked = this.includeCSSComments;
		this.supportIE9 = (ColorZilla.Persist.get("support-ie9", "false") == "true");
		this.supportIE9CheckboxElem.checked = this.supportIE9;
		this.outputFormat = ColorZilla.Persist.get("output-format", "css");
		this.switchToPresetSet("Default");
		this.userGradientPresets = Gradient.UserPresets.get();
		this.userGradientPresetsIDCounter = this.userGradientPresets.length;
		this.addUserPresets(this.userGradientPresets);
		function f() {
			Refresh.Web.DefaultColorPickerSettings.clientFilesPath = "GradientGenerator/images/";
			_this.colorPicker = new Refresh.Web.ColorPicker("cp1", {startHex: "ffcc00", startMode: "s"});
			_this.colorPicker.updateColorZilla = function() {
				var k = Refresh.Web.ColorMethods.normalizeHex($("cp1_Hex").value);
				_this.colorStopsHandler.changeActiveStopValue("#" + k)
			};
			_this.colorPickerDialogWin = new Window({top: 170, left: 400, maximizable: false, resizable: false, minimizable: false, hideEffect: Element.hide, showEffect: Element.show});
			_this.colorPickerDialogWin.setContent("colorpicker-1", true, false);
			var j = _this.colorPickerElem.select(".dialog-button.ok-button")[0];
			var i = _this.colorPickerElem.select(".dialog-button.cancel-button")[0];
			j.observe("click", function() {
				_this.invalidateCurrentPreset();
				var k = Refresh.Web.ColorMethods.normalizeHex($("cp1_Hex").value);
				_this.lastUsedColor = "#" + k;
				_this.colorPickerDialogWin.close()
			});
			i.observe("click", function() {_this.colorPickerDialogWin.close()});
			Event.observe(window, "keypress", function(k) {if((k.keyCode == Event.KEY_ESC) && _this.colorPickerDialogWin.visible) {_this.colorPickerDialogWin.close()}});
			var myObserver = {onClose: function(k, l) {if(l == _this.colorPickerDialogWin) {_this.colorStopsHandler.changeActiveStopValue(_this.lastUsedColor)}}};
			Windows.addObserver(myObserver);
			var h = [
				{name: "Save Current Gradient", callback: function(k) {_this.onSaveNewPresetButtonClick()}, className: "new-preset"},
				{name: "Delete Gradient", callback: function(k) {_this.deleteUserPreset(k.contextMenuElement)}, className: "delete-preset"},
			];
			new Proto.Menu({
				beforeShow: function(l) {
					var k = l.contextMenuContainerElement.select(".delete-preset")[0];
					if(!l.contextMenuElement.hasClassName("user-preset")) {
						k.addClassName("disabled");
						k.removeClassName("enabled")
					} else {
						k.addClassName("enabled");
						k.removeClassName("disabled")
					}
				},
				selector: ".has-preset-contextmenu",
				className: "menu desktop preset-context-menu",
				menuItems: h
			});
			_this.updateOutputFormatHeaders();
			_this.initCopyToClipboard()
		}

		setTimeout(f, 10);
		setTimeout(function() {_this.gradientAdjuster = new Gradient.Adjustments(_this)}, 10);
		var d = this.getGradientFromPermalinkHash(window.location.hash);
		var e;
		if(d) {e = d} else {if(this.userGradientPresets.length > 0) {e = this.userGradientPresets[this.userGradientPresets.length - 1]} else {e = Gradient.DB.Default.gradients[0]}}
		this.setCurrentPreset(e.name, Gradient.Utils.deepClone(e.stops), Gradient.Utils.deepClone(this.getGradientPresetOpacityStops(e)));
		Event.observe(window, "hashchange", this.onHashChanged.bind(this));
		this.uiUpdateTimerID = 0
	};
	Gradient.Editor.prototype = {
		cssGradientsSupported: function() {
			var b = "background-image:gradient(linear,left top,right bottom,from(#222),to(#444));" +
				"background-image:-o-gradient(linear,left top,right bottom,from(#222),to(#444));" +
				"background-image:-moz-gradient(linear,left top,right bottom,from(#222),to(#444));" +
				"background-image:-ms-gradient(linear,left top,right bottom,from(#222),to(#444));" +
				"background-image:-webkit-gradient(linear,left top,right bottom,from(#222),to(#444));" +
				"background-image:-khtml-gradient(linear,left top,right bottom,from(#222),to(#444));" +
				"background-image:linear-gradient(left top,#222, #444);" +
				"background-image:-o-linear-gradient(left top,#222, #444);" +
				"background-image:-moz-linear-gradient(left top,#222, #444);" +
				"background-image:-ms-linear-gradient(left top,#222, #444);" +
				"background-image:-webkit-linear-gradient(left top,#222, #444);" +
				"background-image:-khtml-linear-gradient(left top,#222, #444);";
			var a = document.createElement("div");
			a.style.cssText = b;
			return a.style.backgroundImage.indexOf("gradient") !== -1
		},
		formatCSSColor: function(a, c, d) {
			if((d == "hex") || ((d == "iehex") && (c == 1))) {return a.toLowerCase()}
			if(d == "iehex") {
				a = a.toLowerCase();
				if(a.substr(0, 1) == "#") {a = a.substring(1)}
				c = Math.round(c * 255);
				c = Gradient.Utils.decimalToHexa(c);
				return"#" + c + a
			}
			var b = Gradient.Utils.hexaToRGB(a);
			if(d == "rgb") {return Gradient.Utils.rbgToRGBCSS(b)}
			if(d == "rgba") {return Gradient.Utils.rbgAndAlphaToRGBACSS(b, c)}
			if(d == "hsl") {return Gradient.Utils.rgbToHSLCSS(b)}
			if(d == "hsla") {return Gradient.Utils.rgbToHSLCSS(b, c)}
			return a
		},
		generateCSSRules: function(k, g, v) {
			var m = k;
			if(typeof(g) == "undefined") {g = "horizontal"}
			if(typeof(v) == "undefined") {v = "hex"}
			var s, a, f, z, e, x, y;
			var n = "linear";
			var C = false;
			switch(g) {
				case"horizontal":
					s = "left top, right top";
					a = "left";
					f = "GradientType=1";
					z = "horizontal";
					e = "left";
					x = "left";
					y = "to right";
					break;
				case"vertical":
					s = "left top, left bottom";
					a = "top";
					f = "GradientType=0";
					z = "vertical";
					e = "top";
					x = "top";
					y = "to bottom";
					break;
				case"diagonal":
					s = "left top, right bottom";
					a = "-45deg";
					f = "GradientType=1";
					z = "horizontal";
					e = "-45deg";
					C = true;
					x = "left top";
					y = "135deg";
					break;
				case"diagonal-bottom":
					s = "left bottom, right top";
					a = "45deg";
					f = "GradientType=1";
					z = "horizontal";
					e = "45deg";
					C = true;
					x = "left bottom";
					y = "45deg";
					break;
				case"radial":
					n = "radial";
					s = "center center, 0px, center center, 100%";
					a = "center, ellipse cover";
					f = "GradientType=1";
					z = "horizontal";
					e = "center, ellipse cover";
					x = "center, ellipse cover";
					C = true;
					y = "ellipse at center";
					break
			}
			var B = (v == "rgba") ? "rgb" : ((v != "hex") && (v != "rgb") ? "hex" : v);
			var l = this.formatCSSColor(m[0].color, 1, B);
			var r = [];
			var d = [];
			var o = [];
			var c = this.formatCSSColor(m[0].color, m[0].opacity, "iehex");
			var q = this.formatCSSColor(m[m.length - 1].color, m[m.length - 1].opacity, "iehex");
			var ieCSS = "startColorstr='" + c + "', endColorstr='" + q + "'";
			for(var w = 0; w < m.length; w++) {
				var u = this.formatCSSColor(m[w].color, m[w].opacity, v);
				var D = m[w].position;
				r.push(u + " " + D);
				d.push("color-stop(" + D + "," + u + ")")
			}
			var E = r;
			var A = a;
			var o = E;
			r = r.join(", ");
			r = "-moz-" + n + "-gradient(" + a + ",  " + r + ")";
			d = d.join(", ");
			d = "-webkit-gradient(" + n + ", " + s + ", " + d + ")";
			ieCSS = "progid:DXImageTransform.Microsoft.gradient( " + ieCSS + "," + f + " )";
			o = "-o-" + n + "-gradient(" + e + ",  " + o + ")";
			var t = "-webkit-" + n + "-gradient(" + A + ",  " + E + ")";
			var h = "-ms-" + n + "-gradient(" + A + ",  " + E + ")";
			var p = E;
			var E = n + "-gradient(" + y + ",  " + E + ")";
			var j = n + "-gradient(" + x + ",  " + p + ")";
			var b = "filter-gradient(" + c + ", " + q + ", " + z + ");";
			return{kind: n, solid: l, moz: r, webkit: d, newWebkit: t, ie: ieCSS, ieCSSIsFallback: C, ieCSS3: h, opera: o, w3Standard: E, standardSCSS: j, ieSCSS: b}
		},
		generateSVGRule: function(a, c) {
			var b = this.generateSVG(a, c);
			var d = Gradient.Utils.dataURIEncode(b, "image/svg+xml");
			return"url(" + d + ")"
		},
		generateSVG: function(n, b) {
			var m = n;
			var j;
			var k = "linear";
			var h = 'x="0" y="0" width="1" height="1"';
			switch(b) {
				case"horizontal":
					j = 'x1="0%" y1="0%" x2="100%" y2="0%"';
					break;
				case"vertical":
					j = 'x1="0%" y1="0%" x2="0%" y2="100%"';
					break;
				case"diagonal":
					j = 'x1="0%" y1="0%" x2="100%" y2="100%"';
					break;
				case"diagonal-bottom":
					j = 'x1="0%" y1="100%" x2="100%" y2="0%"';
					break;
				case"radial":
					k = "radial";
					j = 'cx="50%" cy="50%" r="75%"';
					h = 'x="-50" y="-50" width="101" height="101"';
					break
			}
			var l = new Date;
			var a = "ucgg-generated";
			var f = [
				'<?xml version="1.0" ?>',
				'<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 1 1" preserveAspectRatio="none">',
				"  <" + k + 'Gradient id="grad-' + a + '" gradientUnits="userSpaceOnUse" ' + j + ">",
			];
			for(var d = 0; d < m.length; d++) {
				var c = m[d].color.toLowerCase();
				var g = m[d].opacity;
				var e = m[d].position;
				f.push('    <stop offset="' + e + '" stop-color="' + c + '" stop-opacity="' + g + '"/>')
			}
			f.push("  </" + k + "Gradient>");
			f.push("  <rect " + h + ' fill="url(#grad-' + a + ')" />');
			f.push("</svg>");
			f = f.join("\n");
			return f
		},
		setElementGradientBackground: function(b, a) {
			try {b.style.background = a.solid} catch(c) {}
			try {b.style.background = a.moz} catch(c) {}
			try {b.style.background = a.webkit} catch(c) {}
			try {b.style.background = a.newWebkit} catch(c) {}
			try {b.style.background = a.opera} catch(c) {}
			try {b.style.background = a.ieCSS3} catch(c) {}
			try {b.style.filter = a.ie} catch(c) {}
			try {b.style.background = a.w3Standard} catch(c) {}
		},
		setColorStops: function(a) {
			this.colorStopsHandler.setStops(a);
			this.updateAllUI()
		},
		setAllStops: function(b, a) {
			this.colorStopsHandler.setStops(b);
			if((typeof a == "undefined") || (!a)) {this.opacityStopsHandler.setStops(this.opacityStopsHandler.defaultStops)} else {this.opacityStopsHandler.setStops(a)}
			this.updateAllUI()
		},
		getColorStops: function() {return this.colorStopsHandler.getStops()}, getOpacityStops: function() {return this.opacityStopsHandler.getStops()}, currentGradientHasOpacity: function() {
			var a = this.getOpacityStops();
			return Gradient.StopUtils.gradientHasOpacity({stops: a})
		},
		getMergedStops: function() {
			if(this.currentGradientHasOpacity()) {return Gradient.StopUtils.mergeStops(this.getColorStops(), this.getOpacityStops())} else {
				var b = Gradient.Utils.deepClone(this.getColorStops());
				for(var a = 0; a < b.length; a++) {b[a].opacity = 1}
				return b
			}
		},
		getGradientPresetOpacityStops: function(a) {return"opacityStops" in a ? a.opacityStops : this.opacityStopsHandler.defaultStops},
		setNewStopColor: function(a) {this.lastUsedColor = a},
		updateAllUI: function() {
			this.mergedStops = this.getMergedStops();
			this.updateGradientPanel();
			this.colorStopsHandler.updateStopMarkers();
			this.opacityStopsHandler.updateStopMarkers();
			this.switchToOpacitySupportingColorModeIfNeeded();
			this.cssRules = this.generateCSSRules(this.mergedStops, this.outputOrientation, this.cssColorFormat);
			this.updatePreviewElement();
			var a = this;
			clearTimeout(this.uiUpdateTimerID);
			this.uiUpdateTimerID = setTimeout(function() {
					if(a.supportIE9) {a.cssRules.svg = a.generateSVGRule(a.mergedStops, a.outputOrientation)}
					a.updatePermalink();
					a.updateCSSOutput()
				},
				50)
		},
		switchToOpacitySupportingColorModeIfNeeded: function() {
			if(this.currentGradientHasOpacity() && (this.cssColorFormat != "rgba") && (this.cssColorFormat != "hsla")) {
				this.cssColorFormat = this.cssColorFormat == "hsl" ? "hsla" : "rgba";
				this.colorFormatSelectorElem.value = this.cssColorFormat;
				this.cssNotesTextElem.innerHTML = "Current gradient has opacity, switching color format to '" + this.cssColorFormat + "'";
				this.cssNotesElem.show();
				ColorZilla.Persist.set("css-color-format", this.cssColorFormat)
			}
		},
		adjustCopyButtonPositionForScrollbar: function() {
			if(typeof this.scrollbarWidth == "undefined") {
				var b = $$(".scrollbar-measure")[0];
				this.scrollbarWidth = (b.offsetWidth - b.clientWidth);
				this.cssCopyButtonElemLastMargin = -1
			}
			var a = (this.cssTextElem.scrollHeight > this.cssTextElem.getHeight()) ? this.scrollbarWidth : 1;
			if(a != this.cssCopyButtonElemLastMargin) {
				this.cssCopyButtonElemLastMargin = a;
				this.cssCopyButtonElem.style.marginRight = a + "px"
			}
		},
		updatePermalink: function() {
			var a = this.currentGradientToHash();
			this.permalinkElem.setAttribute("href", "#" + a)
		},
		updateGradientPanel: function() {
			var b = this.mergedStops;
			var a = this.generateCSSRules(b, "horizontal", "rgba");
			this.setElementGradientBackground(this.gradientPanelElem, a)
		},
		updateCSSOutput: function() {
			var b = this.cssRules;
			var a = [];
			var d = [];
			var f = "IE9 SVG, needs conditional override of 'filter' to 'none'";
			var c = "IE6-9";
			if(this.supportIE9) {c = "IE6-8"}
			if(b.ieCSSIsFallback) {c += " fallback on horizontal gradient"}
			var e;
			if(this.outputFormat == "css") {
				if(!this.currentGradientHasOpacity()) {a.push("background: " + b.solid + ";" + (this.includeCSSComments ? " /* Old browsers */" : ""))}
				if(this.supportIE9) {
					if(this.includeCSSComments) {a.push("/* " + f + " */")}
					a.push("background: " + b.svg + ";")
				}
				a.push("background: " + b.webkit + ";" + (this.includeCSSComments ? " /* Chrome,Safari4+ */" : ""));
				a.push("background: " + b.newWebkit + ";" + (this.includeCSSComments ? " /* Chrome10+,Safari5.1+ */" : ""));
				a.push("background: " + b.moz + ";" + (this.includeCSSComments ? " /* FF3.6+ */" : ""));
				a.push("background: " + b.ieCSS3 + ";" + (this.includeCSSComments ? " /* IE10+ */" : ""));
				a.push("background: " + b.opera + ";" + (this.includeCSSComments ? " /* Opera " + (b.kind == "linear" ? "11.10+" : "12+") + " */" : ""));
				a.push("background: " + b.w3Standard + ";" + (this.includeCSSComments ? " /* W3C */" : ""));
				a.push("filter: " + b.ie + ";" + (this.includeCSSComments ? " /* " + c + " */" : ""));
				e = a
			} else {
				if(this.includeCSSComments) {d.push("// needs latest Compass, add '@import \"compass\"' to your scss")}
				if(!this.currentGradientHasOpacity()) {d.push("background-color: " + b.solid + ";" + (this.includeCSSComments ? " // Old browsers" : ""))}
				d.push("@include " + b.ieSCSS + (this.includeCSSComments ? " // " + c : ""));
				if(this.supportIE9) {
					if(this.includeCSSComments) {d.push("// " + f)}
					d.push("$experimental-support-for-svg: true;")
				}
				d.push("@include background-image(" + b.standardSCSS + ");");
				e = d
			}
			this.cssTextElem.innerHTML = "<div>" + e.join("</div><div>") + "</div>";
			if(typeof this.initialStateRemoved == "undefined") {
				this.cssTextElem.removeClassName("initial");
				this.initialStateRemoved = true
			}
			this.adjustCopyButtonPositionForScrollbar()
		},
		updatePreviewElement: function() {
			var b;
			if(!this.previewAsIE) {b = this.cssRules} else {
				var d = this.getMergedStops();
				var a = [d[0], d[d.length - 1]];
				var c = (this.outputOrientation.substr(0, 8) != "diagonal") && (this.outputOrientation != "radial") ? this.outputOrientation : "horizontal";
				b = this.generateCSSRules(a, c, "rgba")
			}
			this.setElementGradientBackground(this.previewElem, b);
			this.previewBackgroundElem.style.width = this.previewDimensionsWidth + "px";
			this.previewBackgroundElem.style.height = this.previewDimensionsHeight + "px"
		},
		updateOutputFormatHeaders: function() {
			if(this.outputFormat == "scss") {
				var currentFormatStr = "SCSS (Sass)";
				var switchToNewFormatStr = "switch to css"
			} else {
				var currentFormatStr = "CSS";
				var switchToNewFormatStr = "switch to scss"
			}
			this.currentOutputFormatElem.innerHTML = currentFormatStr;
			this.switchOutputFormatElem.innerHTML = switchToNewFormatStr
		},
		setLastUsedColorFromCurrentGradient: function() {
			var a = this.getColorStops();
			this.lastUsedColor = a[0].color
		},
		onHashChanged: function() {
			var b = window.location.hash;
			if(!b || (b == "#")) {return}
			var a = this.getGradientFromPermalinkHash(b);
			if(!a) {return}
			this.setCurrentPreset(a.name, Gradient.Utils.deepClone(a.stops), Gradient.Utils.deepClone(this.getGradientPresetOpacityStops(a)))
		},
		resetURLHash: function() {
			var a = window.location.hash;
			if(a && (a.length > 6)) {window.location.hash = "#_"}
		},
		getGradientFromPermalinkHash: function(f) {
			if(!f || !f.match(/,/)) {return null}
			if(f.substr(0, 1) == "#") {f = f.substring(1)}
			var d = f.split(";");
			var a = d.length > 1 ? decodeURIComponent(d[1]) : "Custom";
			a = a.replace(/\+/g, " ");
			a = a.replace(/[^0-9a-zA-Z \-_\.#]/g, " ");
			var b = d[0];
			var n = b.split("&");
			b = n[0];
			var k = (n.length == 2) ? n[1] : null;
			var j = b.split(",");
			var p = [];
			for(var e = 0; e < j.length; e++) {
				var m = j[e].split("+");
				var c = m[0];
				if(!c.match(/^[0-9a-fA-F]{6}$/)) {c = "ffffff"}
				c = "#" + c;
				var l = m[1];
				if(!l.match(/^\d{1,3}$/)) {l = "0"}
				l += "%";
				p.push({color: c, position: l})
			}
			var g = null;
			if(k) {
				var j = k.split(",");
				g = [];
				for(var e = 0; e < j.length; e++) {
					var m = j[e].split("+");
					var h = m[0];
					if(!h.match(/^[0-9\.]+$/)) {h = 1}
					var l = m[1];
					if(!l.match(/^\d{1,3}$/)) {l = "0"}
					l += "%";
					g.push({opacity: h, position: l})
				}
			}
			var o = {name: a, stops: p};
			if(g) {o.opacityStops = g}
			return o
		},
		currentGradientToHash: function() {
			var c = [];
			var j = this.getColorStops();
			for(var e = 0; e < j.length; e++) {
				var h = j[e];
				var b = h.color.toLowerCase();
				if(b.substr(0, 1) == "#") {b = b.substring(1)}
				var g = parseInt(h.position);
				c.push(b + "+" + g)
			}
			var d = c.join(",");
			if(this.currentGradientHasOpacity()) {
				var c = [];
				var j = this.getOpacityStops();
				for(var e = 0; e < j.length; e++) {
					var h = j[e];
					var f = h.opacity;
					var g = parseInt(h.position);
					c.push(f + "+" + g)
				}
				d += "&" + c.join(",")
			}
			var a = encodeURIComponent(this.getCurrentPresetName());
			a = a.replace(/%20/g, "+");
			d += ";" + a;
			return d
		},
		openColorPickerAndGetColor: function(b) {
			var a = window.prompt("Enter new color");
			if(a !== null) {b(a)}
		},
		initCopyToClipboard: function() {
			if(!FlashDetect.installed) {
				this.cssCopyButtonElem.addClassName("no-flash");
				return
			}
			ZeroClipboard.setMoviePath("GradientGenerator/images/ZeroClipboard.swf");
			var b = new ZeroClipboard.Client();
			b.setHandCursor(true);
			var a = this;
			b.addEventListener("load", function(c) {});
			b.addEventListener("mouseOver", function(c) {
				var d = a.cssTextElem.innerHTML;
				d = d.replace(/<div[^>]*>/g, "");
				d = d.replace(/<\/div>/g, "\r\n");
				b.setText(d)
			});
			b.addEventListener("complete", function(c, d) {
				a.cssCopyStatusElem.show();
				setTimeout(function() {a.cssCopyStatusElem.hide()}, 2000)
			});
			b.glue(this.cssCopyButtonElem, this.cssCopyButtonContainerElem)
		},
		openColorPicker: function(a, c) {
			this.colorPickerDialogWin.show(true);
			$("cp1_Hex").focus();
			var b = this.lastUsedColor.substring(1);
			this.colorPicker._cvp._hexInput.value = b;
			this.colorPicker._cvp.setValuesFromHex();
			this.colorPicker.positionMapAndSliderArrows();
			this.colorPicker.updateVisuals()
		},
		switchToPresetSet: function(b) {
			this.clearPresets();
			var a = Gradient.DB[b];
			if(typeof(a) == "undefined") {return}
			if(typeof(a.license) != "undefined") {}
			for(var c = 0; c < a.gradients.length; c++) {this.addPreset(a.gradients[c])}
		},
		addUserPresets: function(a) {for(var b = 0; b < a.length; b++) {this.addPreset(a[b], true, true)}}, clearPresets: function() {
			var a = this.presetsContainerElem;
			if(!a.hasChildNodes()) {return}
			while(a.childNodes.length >= 1) {a.removeChild(a.firstChild)}
		},
		addPreset: function(i, l, d) {
			var j = i.stops;
			var a = i.name;
			var c = this.getGradientPresetOpacityStops(i);
			var e = document.createElement("div");
			e.className = "preset-item-background gradient-background";
			var b = document.createElement("div");
			var g = "preset-item  has-preset-contextmenu";
			if(d) {
				g += " user-preset";
				if("uniqueID" in i) {b.setAttribute("preset-id", i.uniqueID)}
			}
			b.className = g;
			var k = Gradient.StopUtils.mergeStops(j, c);
			var f = this.generateCSSRules(k, "diagonal", "rgba");
			this.setElementGradientBackground(b, f);
			var h = this;
			var j = j.toJSON();
			var c = c.toJSON();
			Element.extend(b);
			b.observe("click", function(m) {
				if(!Event.isLeftClick(m)) {return}
				h.resetURLHash();
				h.setCurrentPreset(a, j.evalJSON(true), c.evalJSON(true))
			});
			e.appendChild(b);
			if(!l || !this.presetsContainerElem.firstChild) {this.presetsContainerElem.appendChild(e)} else {this.presetsContainerElem.insertBefore(e, this.presetsContainerElem.firstChild)}
		},
		deletePreset: function(b) {
			var a = b.up(".preset-item-background");
			a.parentNode.removeChild(a)
		},
		deleteUserPreset: function(d) {
			this.deletePreset(d);
			var c = d.getAttribute("preset-id");
			var b = [];
			for(var a = 0; a < this.userGradientPresets.length; a++) {if(c != this.userGradientPresets[a].uniqueID) {b.push(this.userGradientPresets[a])}}
			this.userGradientPresets = b;
			Gradient.UserPresets.persist(this.userGradientPresets)
		},
		getCurrentPresetName: function(a) {return this.gradientNameBoxElem.value}, setPresetName: function(a) {this.gradientNameBoxElem.value = a}, setCurrentPreset: function(b, c, a) {
			this.setPresetName(b);
			this.setAllStops(c, a);
			if(this.gradientAdjuster) {this.gradientAdjuster.resetAllAdjustments()}
			this.setLastUsedColorFromCurrentGradient()
		},
		invalidateCurrentPreset: function(a) {
			this.setPresetName("Custom");
			this.resetURLHash();
			if(!a && this.gradientAdjuster) {this.gradientAdjuster.resetAllAdjustments()}
		},
		saveNewPreset: function() {
			var a = {name: this.getCurrentPresetName(), stops: this.getColorStops()};
			if(this.currentGradientHasOpacity()) {a.opacityStops = this.getOpacityStops()}
			a.uniqueID = this.userGradientPresetsIDCounter;
			this.userGradientPresetsIDCounter++;
			this.addPreset(a, true, true);
			a = Gradient.Utils.deepClone(a);
			this.userGradientPresets.push(a);
			Gradient.UserPresets.persist(this.userGradientPresets)
		},
		toggleImportCSSPanel: function() {
			this.showHideImportImagePanel(false);
			Element.toggle(this.importFromCSSPanel)
		},
		toggleImportImagePanel: function() {
			this.showHideImportCSSPanel(false);
			Element.toggle(this.importFromImagePanel)
		},
		showHideImportPanel: function(b, a) {if(a) {Element.show(b)} else {Element.hide(b)}},
		showHideImportCSSPanel: function(a) {this.showHideImportPanel(this.importFromCSSPanel, a)},
		showHideImportImagePanel: function(a) {this.showHideImportPanel(this.importFromImagePanel, a)},
		showIE9SupportInstructions: function() {
			var a = [
				'Support for full multi-stop gradients with IE9 (using SVG).<p>Add a "gradient" class to all your elements that have a gradient,',
				"and add the following override to your HTML to complete the IE9 support:",
				"<pre>&lt;!--[if gte IE 9]&gt;",
				'  &lt;style type="text/css"&gt;',
				"    .gradient {",
				"       filter: none;",
				"    }",
				"  &lt;/style&gt;",
				"&lt;![endif]--&gt;</pre>",
			];
			this.cssNotesTextElem.innerHTML = a.join("\n");
			this.cssNotesElem.show()
		},
		exportToImageDataURL: function() {
			var a = this.previewDimensionsWidth;
			var l = this.previewDimensionsHeight;
			var c = document.createElement("canvas");
			c.setAttribute("width", a);
			c.setAttribute("height", l);
			var m = c.getContext("2d");
			var j = this.outputOrientation == "horizontal" ? a : 0;
			var h = this.outputOrientation == "horizontal" ? 0 : l;
			var b = m.createLinearGradient(0, 0, j, h);
			var k = this.getColorStops();
			for(var e = 0; e < k.length; e++) {
				var g = k[e];
				var f = parseInt(g.position) / 100;
				b.addColorStop(f, g.color)
			}
			m.fillStyle = b;
			m.fillRect(0, 0, a, l);
			var d = c.toDataURL("image/png");
			return d
		},
		onStopActivated: function(a) {
			if(a == "color") {
				this.opacityStopsHandler.setActiveStopMakerElemAndUpdateDetailsPanel(null)
			} else {this.colorStopsHandler.setActiveStopMakerElemAndUpdateDetailsPanel(null)}
		},
		onOrientationSelectorChange: function(b) {
			var a = Event.element(b);
			this.outputOrientation = a.value;
			this.updateAllUI();
			ColorZilla.Persist.set("output-orientation", this.outputOrientation)
		},
		onPreviewDimensionsChange: function(a) {
			this.previewDimensionsWidth = Math.min(parseInt(this.previewDimensionWidthElem.value), 370);
			this.previewDimensionsHeight = Math.min(parseInt(this.previewDimensionHeightElem.value), 350);
			this.previewDimensionWidthElem.value = this.previewDimensionsWidth;
			this.previewDimensionHeightElem.value = this.previewDimensionsHeight;
			this.updatePreviewElement();
			ColorZilla.Persist.set("preview-width", this.previewDimensionsWidth);
			ColorZilla.Persist.set("preview-height", this.previewDimensionsHeight)
		},
		onPreviewAsIECheckboxChange: function(b) {
			var a = Event.element(b);
			this.previewAsIE = a.checked;
			this.updatePreviewElement()
		},
		onColorFormatSelectorChange: function(b) {
			var a = Event.element(b);
			this.cssColorFormat = a.value;
			this.cssNotesElem.hide();
			this.updateAllUI();
			ColorZilla.Persist.set("css-color-format", this.cssColorFormat)
		},
		onIncludeCSSCommentsCheckboxChange: function(b) {
			var a = Event.element(b);
			this.includeCSSComments = a.checked;
			this.updateAllUI();
			ColorZilla.Persist.set("include-css-comments", this.includeCSSComments ? "true" : "false")
		},
		onSupportIE9CheckboxChange: function(b) {
			var a = Event.element(b);
			this.supportIE9 = a.checked;
			this.updateAllUI();
			ColorZilla.Persist.set("support-ie9", this.supportIE9 ? "true" : "false");
			if(this.supportIE9) {this.showIE9SupportInstructions()} else {this.cssNotesElem.hide()}
		},
		onImportFromCSSButtonClicked: function(a) {
			this.importFromCSSTextElem.value = "";
			this.toggleImportCSSPanel()
		},
		onImportFromImageButtonClicked: function(a) {
			this.importFromImageForm.reset();
			this.toggleImportImagePanel()
		},
		onImportFromCSSPanelOkButtonClick: function(b) {
			var a = this.importFromCSSTextElem.value;
			if(!a) {
				this.showHideImportCSSPanel(false);
				return
			}
			if(!this.cssImporter) {this.cssImporter = new Gradient.Importer()}
			var c = this.cssImporter.parseCSS(a);
			if(!c) {
				alert("Couldn't parse gradient CSS.\nPlease check the format and try again.");
				return
			}
			this.setAllStops(c.stops, c.opacityStops);
			this.invalidateCurrentPreset();
			this.showHideImportCSSPanel(false)
		},
		onImportFromImagePanelOkButtonClick: function(b) {
			if(!this.importFromImageFileInputElem.value && !this.importFromImageURLInputElem.value) {
				alert("Please specify file to upload or URL");
				return
			}
			this.importFromImageForm.target = "import-image-upload-target";
			this.importFromImageForm.submit();
			var a = this;
			window.importFromImageCallback = function(c) {a.onImportFromImageCallback(c)}
		},
		onImportFromImageCallback: function(a) {
			if(!a) {
				alert("There was an error importing the gradient.\nPlease verify that you provided a valid gradient image and try again.");
				return
			} else {
				var b = a.evalJSON(true);
				if(!b) {
					alert("There was an error in the gradient data.\nPlease verify that you provided a valid gradient image and try again.");
					return
				}
				this.setAllStops(b.stops, "opacityStops" in b ? b.opacityStops : null);
				this.invalidateCurrentPreset();
				this.showHideImportImagePanel(false)
			}
		},
		onImportFromCSSPanelCancelButtonClick: function(a) {this.showHideImportCSSPanel(false)},
		onImportFromImagePanelCancelButtonClick: function(a) {this.showHideImportImagePanel(false)},
		onSaveNewPresetButtonClick: function(a) {this.saveNewPreset()},
		onSwitchOutputFormatClicked: function(c) {
			Event.stop(c);
			var b, a;
			if(this.outputFormat == "css") {this.outputFormat = "scss"} else {this.outputFormat = "css"}
			this.updateOutputFormatHeaders();
			ColorZilla.Persist.set("output-format", this.outputFormat);
			this.updateAllUI()
		},
	};
	Gradient.Adjustments = function(b) {
		this.gradientEditor = b;
		this.gradientControl = this.gradientEditor.gradientControl;
		var h = this.gradientControl.select(".gradient-adjustments-panel")[0];
		this.adjustments = ["hue", "sat", "light"];
		this.adjustmentSliderElems = {};
		this.adjustmentEditBoxElems = {};
		this.adjustmentRanges = {hue: {min: -180, max: 180}, sat: {min: -100, max: 100}, light: {min: -100, max: 100}, };
		for(var c = 0; c < this.adjustments.length; c++) {
			var k = this.adjustments[c];
			var g = h.select("." + k + "-adjust-bar-container")[0];
			var f = g.select("." + k + "-adjust-bar")[0];
			var l = h.select("." + k + "-adjust-value")[0];
			var a = Gradient.Utils.blankURI;
			var d = new Refresh.Web.Slider(f, {xMinValue: 1, xMaxValue: this.adjustmentRanges[k].max * 2, yMinValue: 1, yMaxValue: 1, arrowImage: a}, g);
			this.adjustmentSliderElems[k] = d;
			this.adjustmentEditBoxElems[k] = l;
			d.onValuesChanged = this.onSliderValueChanged.bind(this, d, k);
			l.observe("keyup", this.onAdjustValueEntryBoxKeyUp.bindAsEventListener(this, k));
			l.observe("keydown", this.onAdjustValueEntryBoxKeyDown.bindAsEventListener(this, k));
			l.observe("blur", this.onAdjustValueEntryBoxBlur.bindAsEventListener(this, k))
		}
		this.adjustHueSaturationPanel = h.select(".adjust-hue-saturation-panel")[0];
		this.adjustHueSaturationPanelOkButton = this.adjustHueSaturationPanel.select("button.ok")[0];
		this.adjustHueSaturationPanelOkButton.observe("click", this.onAdjustHueSaturationPanelOkButtonClick.bind(this));
		this.adjustHueSaturationPanelCancelButton = this.adjustHueSaturationPanel.select("button.cancel")[0];
		this.adjustHueSaturationPanelCancelButton.observe("click", this.onAdjustHueSaturationPanelCancelButtonClick.bind(this));
		var e = h.select("button.adjust-reverse")[0];
		e.observe("click", this.onReverseGradientButtonClick.bind(this));
		var j = h.select("button.adjust-hue-sat")[0];
		j.observe("click", this.onAdjustHueSaturationButtonClick.bind(this));
		this.resetAllAdjustments()
	};
	Gradient.Adjustments.prototype = {
		resetSpecificAdjustment: function(a) {
			this.adjustmentEditBoxElems[a].value = 0;
			this.adjustmentSliderElems[a].xValue = this.adjustmentRanges[a].max;
			this.adjustmentSliderElems[a].setArrowPositionFromValues()
		},
		resetAllAdjustments: function(b) {
			if(!this.adjustmentsMade && (typeof b == "undefined")) {return}
			this.adjustmentsMade = false;
			this.preAdjustmentStops = null;
			for(var a = 0; a < this.adjustments.length; a++) {this.resetSpecificAdjustment(this.adjustments[a])}
			this.currentAdjustments = {hue: 0, sat: 0, light: 0}
		},
		startAdjusting: function() {
			if(this.adjustmentsMade) {return}
			this.preAdjustmentStops = Gradient.Utils.deepClone(this.gradientEditor.getColorStops());
			this.adjustmentsMade = true;
			this.gradientEditor.invalidateCurrentPreset(true)
		},
		setGradientAdjustment: function(b, a) {
			this.startAdjusting();
			this.currentAdjustments[a] = b;
			this.adjustGradient()
		},
		adjustGradient: function() {
			var h = Gradient.Utils.deepClone(this.preAdjustmentStops);
			var a = this.currentAdjustments.sat;
			var c = this.currentAdjustments.light;

			function f(k, i) {
				if(i > 0) {k += Math.floor((((255 - k) * i) / 100) + 0.5)} else {if(i < 0) {k += Math.floor(((k * i) / 100) + 0.5)}}
				if(k < 0) {k = 0}
				if(k > 255) {k = 255}
				return k
			}

			for(var b = 0; b < h.length; b++) {
				var e = h[b];
				var d = Gradient.Utils.hexaToRGB(e.color);
				var j = Gradient.Utils.rgbToHSL(d.red, d.green, d.blue);
				j.hue += this.currentAdjustments.hue;
				j.hue = (((j.hue % 360) + 360) % 360);
				j.sat = f(j.sat, a);
				j.light = f(j.light, c);
				var d = Gradient.Utils.hslToRGB(j.hue, j.sat, j.light);
				var g = Gradient.Utils.rgbToHexa(d.red, d.green, d.blue);
				e.color = g
			}
			this.gradientEditor.setColorStops(h)
		},
		revertGradientToPreAdjustmentState: function() {
			if(!this.adjustmentsMade) {return}
			this.gradientEditor.setColorStops(this.preAdjustmentStops)
		},
		revertStops: function(c) {
			var d = [];
			for(var b = c.length - 1; b >= 0; b--) {
				var a = c[b];
				var e = 100 - parseInt(a.position);
				e += "%";
				a.position = e;
				d.push(a)
			}
			return d
		},
		onAdjustHueSaturationButtonClick: function(a) {
			if(Element.visible(this.adjustHueSaturationPanel)) {return}
			Element.show(this.adjustHueSaturationPanel);
			this.resetAllAdjustments(true)
		},
		onAdjustHueSaturationPanelOkButtonClick: function(a) {
			this.resetAllAdjustments();
			Element.hide(this.adjustHueSaturationPanel)
		},
		onAdjustHueSaturationPanelCancelButtonClick: function(a) {
			if(this.adjustmentsMade) {this.revertGradientToPreAdjustmentState()}
			this.onAdjustHueSaturationPanelOkButtonClick(a)
		},
		onReverseGradientButtonClick: function(d) {
			var b = Gradient.Utils.deepClone(this.gradientEditor.getColorStops());
			var e = this.revertStops(b);
			var a = Gradient.Utils.deepClone(this.gradientEditor.getOpacityStops());
			var c = this.revertStops(a);
			this.gradientEditor.setAllStops(e, c);
			this.gradientEditor.invalidateCurrentPreset()
		},
		onSliderValueChanged: function(c, b) {
			var e = c.xValue;
			var d = e - this.adjustmentRanges[b].max;
			var a = (d > 0) ? "+" + d : d;
			this.adjustmentEditBoxElems[b].value = a;
			this.setGradientAdjustment(d, b)
		},
		onAdjustValueEntryBoxKeyUp: function(c, a) {
			var b = Event.element(c);
			this.handleAdjustmentEntryBoxKeyEvent(b, a)
		},
		onAdjustValueEntryBoxKeyDown: function(d, a) {
			var b = Event.element(d);
			var f = parseInt(b.value);
			if(isNaN(f)) {return}
			var e = 38;
			var c = 40;
			var g = d.keyCode;
			if(g == e) {f++}
			if(g == c) {f--}
			b.value = f;
			this.handleAdjustmentEntryBoxKeyEvent(b, a)
		},
		onAdjustValueEntryBoxBlur: function(c, a) {
			var b = Event.element(c);
			var d = b.value;
			if(isNaN(d)) {b.value = 0}
			this.handleAdjustmentEntryBoxKeyEvent(b, a)
		},
		handleAdjustmentEntryBoxKeyEvent: function(d, b) {
			var e = parseInt(d.value);
			if(isNaN(e)) {return}
			var c = this.adjustmentRanges[b].min;
			var a = this.adjustmentRanges[b].max;
			if(e < c) {e = c}
			if(e > a) {e = a}
			this.setGradientAdjustment(e, b);
			this.adjustmentSliderElems[b].xValue = e + a;
			this.adjustmentSliderElems[b].setArrowPositionFromValues();
			if(e > 0) {e = "+" + e}
			d.value = e
		},
	};
	Gradient.Utils = {
		blankURI: "data:image/gif,GIF89a%01%00%01%00%80%00%00%00%00%00%00%00%00!%F9%04%01%00%00%00%00%2C%00%00%00%00%01%00%01%00%00%02%02D%01%00%3B",
		dataURIEncode: function(b, a) {
			var c = Gradient.Utils.btoa(b);
			return"data:" + a + ";base64," + c
		},
		decimalToHexa: function(b) {
			b = 1 * b;
			var a = b.toString(16);
			if(a.length < 2) {a = "0" + a}
			return a
		},
		intToPercent: function(a) {return Math.floor(((a * 100) / 255) + 0.5)},
		hexaToRGB: function(b) {
			var d = b.substr(1, 2);
			var c = b.substr(3, 2);
			var a = b.substr(5, 2);
			d = parseInt(d, 16);
			c = parseInt(c, 16);
			a = parseInt(a, 16);
			return{red: d, green: c, blue: a}
		},
		rgbToHexa: function(e, d, a) {
			var c = Gradient.Utils.decimalToHexa(e) + Gradient.Utils.decimalToHexa(d) + Gradient.Utils.decimalToHexa(a);
			c = "#" + c;
			return c
		},
		rbgToRGBCSS: function(a) {
			var b = a.red + "," + a.green + "," + a.blue;
			return"rgb(" + b + ")"
		},
		rbgAndAlphaToRGBACSS: function(a, c) {
			var b = a.red + "," + a.green + "," + a.blue + "," + c;
			return"rgba(" + b + ")"
		},
		rgbToHSLCSS: function(c, e) {
			var b = Gradient.Utils.rgbToHSL(c.red, c.green, c.blue);
			var d = b.hue + "," + Gradient.Utils.intToPercent(b.sat) + "%," + Gradient.Utils.intToPercent(b.light) + "%";
			var a = (typeof e != "undefined");
			if(a) {d += "," + e}
			return"hsl" + (a ? "a" : "") + "(" + d + ")"
		},
		rgbToHSL: function(a, f, i) {
			a /= 255;
			f /= 255;
			i /= 255;
			var j = Math.max(a, f, i);
			var d = Math.min(a, f, i);
			var c = (j + d) / 2;
			var e, m;
			if(j == d) {e = m = 0} else {
				var k = j - d;
				m = k / ((c > 0.5) ? (2 - j - d) : (j + d));
				switch(j) {
					case a:
						e = (f - i) / k + (f < i ? 6 : 0);
						break;
					case f:
						e = (i - a) / k + 2;
						break;
					case i:
						e = (a - f) / k + 4;
						break
				}
				e /= 6
			}
			e = Math.round(e * 360);
			m = Math.round(m * 255);
			c = Math.round(c * 255);
			return{hue: e, sat: m, light: c}
		},
		hslToRGB: function(d, m, c) {
			d /= 360;
			m /= 255;
			c /= 255;
			var j = (c <= 0.5) ? c * (m + 1) : (c + m) - (c * m);
			var k = c * 2 - j;

			function i(g, b, l) {
				if(l < 0) {l++}
				if(l > 1) {l--}
				if(l * 6 < 1) {return g + (b - g) * l * 6}
				if(l * 2 < 1) {return b}
				if(l * 3 < 2) {return g + (b - g) * (2 / 3 - l) * 6}
				return g
			}

			var a = i(k, j, d + 1 / 3);
			var e = i(k, j, d);
			var f = i(k, j, d - 1 / 3);
			a = Math.round(a * 255);
			e = Math.round(e * 255);
			f = Math.round(f * 255);
			return{red: a, green: e, blue: f}
		},
		rgbToHSV: function(i, h, c) {
			var e, d, j;
			var a, f;
			a = Math.max(i, h, c);
			f = a - Math.min(i, h, c);
			d = (a == 0) ? 0 : (255 * f / a);
			if(d == 0) {
				e = 0
			} else if(i == a) {
				e = 60 * (h - c) / f
			} else if(h == a) {
				e = 120 + 60 * (c - i) / f
			} else if(c == a) {
				e = 240 + 60 * (i - h) / f
			}
			if(e < 0) {e += 360}
			e = Math.round((e * 255) / 360);
			d = Math.round(d);
			j = a;
			return{hue: e, sat: d, val: j}
		},
		hsvToRGB: function(l, h, e) {
			var a, k, n;
			var j, m, d, c, o;
			if(h == 0) {a = k = n = e} else {
				l = ((l * 359) / (255 * 60));
				h /= 255;
				e /= 255;
				j = Math.floor(l);
				m = l - j;
				d = e * (1 - h);
				c = e * (1 - (h * m));
				o = e * (1 - h * (1 - m));
				switch(j) {
					case 0:
						a = e;
						k = o;
						n = d;
						break;
					case 1:
						a = c;
						k = e;
						n = d;
						break;
					case 2:
						a = d;
						k = e;
						n = o;
						break;
					case 3:
						a = d;
						k = c;
						n = e;
						break;
					case 4:
						a = o;
						k = d;
						n = e;
						break;
					default:
						a = e;
						k = d;
						n = c
				}
				a = Math.round(a * 255);
				k = Math.round(k * 255);
				n = Math.round(n * 255)
			}
			return{red: a, green: k, blue: n}
		},
		deepClone: function(a) {return Object.toJSON(a).evalJSON(true)},
		selectTextInNode: function(c) {
			if(("getSelection" in window) && ("createRange" in document)) {
				var b = window.getSelection();
				var a = document.createRange();
				a.selectNodeContents(c);
				b.removeAllRanges();
				b.addRange(a)
			} else if(("selection" in document) && ("createTextRange" in document.body)) {
				document.selection.empty();
				var a = document.body.createTextRange();
				a.moveToElementText(el);
				a.select()
			}
		},
	};
	Gradient.UIUtils = {
		showHideLinkTrigger: function(c, a) {
			var d = Event.element(c);
			var b = $$(a);
			if(b.length == 0) {return false}
			b[0].toggle();
			d.parentNode.toggleClassName("showing");
			return false
		},
		makeResizable: function(a, f, h) {
			var e;
			var c;

			function g(j) {
				Event.stop(j);
				var i = [Event.pointerX(j), Event.pointerY(j)];
				var l = [i[0] - e[0], i[1] - e[1]];
				var k = [c[0] + l[0], c[1] + l[1]];
				a.style.width = k[0] + "px";
				a.style.height = k[1] + "px";
				if(h) {h(a.getWidth(), a.getHeight())}
			}

			function d(i) {
				Event.stop(i);
				e = [Event.pointerX(i), Event.pointerY(i)];
				c = [a.getWidth(), a.getHeight()];
				Event.observe($$("body")[0], "mousemove", g);
				Event.observe($$("body")[0], "mouseup", b)
			}

			function b(i) {
				Event.stop(i);
				Event.stopObserving($$("body")[0], "mousemove", g);
				Event.stopObserving($$("body")[0], "mouseup", b)
			}

			Event.observe(f, "mousedown", d)
		},
	};
	Gradient.Importer = function() {
		this.testElem = document.createElement("div");
		this.testElem.style.display = "none";
		document.documentElement.appendChild(this.testElem);
		this.roundAlpha = true
	};
	Gradient.Importer.prototype = {
		setRoundAlpha: function(a) {this.roundAlpha = a},
		trim: function(a) {return a.replace(/^\s+/, "").replace(/\s+$/, "")},
		cssSplit: function(g, e) {
			var d = [];
			var a = "";
			var f = 0;
			for(var b = 0; b < g.length; b++) {
				var c = g.charAt(b);
				if(c == "(") {f++}
				if(c == ")") {f--}
				if((c == e) && (f == 0)) {
					d.push(a);
					a = ""
				} else {a += c}
			}
			if(a) {d.push(a)}
			return d
		},
		isColor: function(b) {
			if(!b) {return false}
			var a = this.testElem;
			a.style.color = "inherit";
			a.style.color = b;
			return a.style.color != "inherit"
		},
		addPositionsToStopsIfNeeded: function(f) {
			for(var b = 0; b < f.length; b++) {
				var a = f[b];
				if(a.position === null) {
					if(b == 0) {a.position = "0%"} else {
						if(b == (f.length - 1)) {a.position = "100%"} else {
							var e = f[b - 1].position;
							var g = f[b + 1].position;
							var h;
							if(e && g) {h = Math.round((parseInt(e) + parseInt(g)) / 2)} else {
								var c = f.length - 1;
								var d = 100 / c;
								h = Math.round(b * d)
							}
							a.position = h + "%"
						}
					}
				}
			}
			return f
		},
		parseRGBCSSColor: function(i) {
			if(!i) {return null}
			var c = i.replace(/rgba?/, "");
			c = c.replace(/[() ]/g, "");
			var j = c.split(",");
			if(j.length < 3) {return null}
			var d = (j.length == 4) ? j[3] : 1;
			if(this.roundAlpha) {
				d *= 100;
				d = Math.round(d);
				d /= 100
			}
			d = d * 1;
			var h = j[0];
			var f = j[1];
			var a = j[2];
			var e = Gradient.Utils.decimalToHexa(h) + Gradient.Utils.decimalToHexa(f) + Gradient.Utils.decimalToHexa(a);
			e = "#" + e;
			return{value: e, opacity: d}
		},
		parseHSLCSSColor: function(j) {
			if(!j) {return null}
			var c = j.replace(/hsla?/, "");
			c = c.replace(/[() ]/g, "");
			var d = c.split(",");
			if(d.length < 3) {return null}
			var f = (d.length == 4) ? d[3] : 1;
			if(this.roundAlpha) {
				f *= 100;
				f = Math.round(f);
				f /= 100
			}
			f = f * 1;
			var e = d[0];
			var i = parseInt(d[1]) * 255 / 100;
			var b = parseInt(d[2]) * 255 / 100;
			var g = Gradient.Utils.hslToRGB(e, i, b);
			var a = Gradient.Utils.decimalToHexa(g.red) + Gradient.Utils.decimalToHexa(g.green) + Gradient.Utils.decimalToHexa(g.blue);
			a = "#" + a;
			return{value: a, opacity: f}
		},
		resolveColor: function(c) {
			if(!this.isColor(c)) {return null}
			var d = this.testElem;
			d.style.color = "inherit";
			d.style.color = c;
			var b = document.defaultView.getComputedStyle(d, null);
			var a = b.color;
			var e = null;
			if(a == "transparent") {
				if(c.match(/rgba/)) {
					e = this.parseRGBCSSColor(c)
				} else if(c.match(/hsla/)) {
					e = this.parseHSLCSSColor(c)
				}
			} else {
				e = this.parseRGBCSSColor(a)
			}
			return e
		},
		parseStopCSSMozilla: function(d) {
			d = this.trim(d);
			var a = null;
			var b = d;
			var e = d.split(" ");
			if(e.length > 1) {
				var c = e[e.length - 1];
				if(c.match(/^ *[0-9]+% *$|/)) {
					a = this.trim(c);
					b = this.trim(e.slice(0, -1).join(" "))
				}
			}
			b = this.resolveColor(b);
			if(!b) {b = {color: null, opacity: null}}
			return{color: b.value, opacity: b.opacity, position: a}
		},
		parseCSSMozilla: function(e, a) {
			var g = this.cssSplit(e, ",");
			if(g.length < 2) {return null}
			for(var c = 0; c < a; c++) {
				var f = this.trim(g[0]);
				var b = this.parseStopCSSMozilla(f);
				if(!this.isColor(b.color)) {g = g.slice(1)} else {break}
			}
			var d = [];
			for(var c = 0; c < g.length; c++) {
				var b = this.parseStopCSSMozilla(g[c]);
				if(!b) {return null}
				d.push(b)
			}
			this.addPositionsToStopsIfNeeded(d);
			return{stops: d}
		},
		parseStopCSSWebkit: function(d) {
			d = d.replace(/ /g, "");
			d = d.replace(/from\(/, "color-stop(0.0,");
			d = d.replace(/to\(/, "color-stop(1.0,");
			var b = d.match(/color-stop\((.+)\)/);
			if(!b) {return null}
			var e = b[1];
			var f = this.cssSplit(e, ",");
			if(f.length < 2) {return null}
			var a = f[0];
			if(a.indexOf("%") == -1) {
				a = Math.round(a * 100);
				a = a + "%"
			}
			var c = f[1];
			c = this.resolveColor(c);
			if(!c) {c = {color: null, opacity: null}}
			return{color: c.value, opacity: c.opacity, position: a}
		},
		parseCSSWebkit: function(g, d) {
			var h = this.cssSplit(g, ",");
			if(h.length < 4) {return null}
			var f = this.trim(h[0]);
			var c = this.trim(h[1]);
			h = h.slice(d);
			var e = [];
			for(var b = 0; b < h.length; b++) {
				var a = this.parseStopCSSWebkit(h[b]);
				if(!a) {return null}
				e.push(a)
			}
			return{stops: e, startPoint: f, endPoint: c}
		},
		parseCSSIE: function(g) {
			var f = null;
			var b = null;
			var d = g.split(",");
			for(var e = 0; e < d.length; e++) {
				var a = d[e];
				if(result = a.match(/startColorstr *= *'?([^']*)'?/i)) {f = result[1].toLowerCase()} else {if(result = a.match(/endColorstr *= *'?([^']*)'?/i)) {b = result[1].toLowerCase()}}
			}
			if(!f || !b) {return null}
			var j = 1;
			var c = 1;
			if(f.length == 9) {
				j = f.substr(1, 2);
				j = Math.round((parseInt(j, 16) / 255) * 100) / 100;
				f = "#" + f.substr(3)
			}
			if(b.length == 9) {
				c = b.substr(1, 2);
				c = Math.round((parseInt(c, 16) / 255) * 100) / 100;
				b = "#" + b.substr(3)
			}
			var h = [
				{color: f, opacity: j, position: "0%"},
				{color: b, opacity: c, position: "100%"},
			];
			return{stops: h}
		},
		parseCSS: function(a) {
			var b = null;
			a = a.replace(/[\n\r]/g, "");
			a = a.replace(/[;]/g, "\n");
			if(result = a.match(/linear-gradient *\((.+)\)/)) {
				b = this.parseCSSMozilla(result[1], 1)
			} else if(result = a.match(/-webkit-gradient *\( *linear *, *(.+)\)/)) {
				b = this.parseCSSWebkit(result[1], 2)
			} else if(result = a.match(/progid:DXImageTransform.Microsoft.gradient *\((.+)\)/)) {
				b = this.parseCSSIE(result[1])
			} else if(result = a.match(/radial-gradient *\((.+)\)/)) {
				b = this.parseCSSMozilla(result[1], 2)
			} else if(result = a.match(/-webkit-gradient *\( *radial *, *(.+)\)/)) {
				b = this.parseCSSWebkit(result[1], 4)
			}
			if(!b) {return null}
			if(b && Gradient.StopUtils.gradientHasOpacity(b)) {b = Gradient.StopUtils.splitStopsIntoColorAndOpacity(b)} else {
				b = Gradient.StopUtils.extractColorOnlyStops(b);
				b.opacityStops = null
			}
			return b
		},
	};
	Gradient.UserPresets = {get: function() {
		var a = ColorZilla.LocalStorage.get("user-gradient-presets", null);
		if(!a) {return[]}
		a = a.evalJSON(true);
		for(var b = 0; b < a.length; b++) {a[b].uniqueID = b}
		return a
	},
		persist: function(a) {
			var b = a.toJSON();
			return ColorZilla.LocalStorage.set("user-gradient-presets", b)
		}}
		/*
		 base-64 URL encoder/decoder from webtoolkit
		 http://www.webtoolkit.info/javascript-base64.html
		 http://creativecommons.org/licenses/by/2.0/uk/
		 */
	;
	Gradient.Utils.btoa = function(d) {
		var b = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
			a = "", l, j, g, k, h, f, e, c = 0;
		while(c < d.length) {
			l = d.charCodeAt(c++);
			j = d.charCodeAt(c++);
			g = d.charCodeAt(c++);
			k = l>>2;
			h = ((l & 3)<<4) | (j>>4);
			f = ((j & 15)<<2) | (g>>6);
			e = g & 63;
			if(isNaN(j)) {f = e = 64} else {if(isNaN(g)) {e = 64}}
			a = a + b.charAt(k) + b.charAt(h) + b.charAt(f) + b.charAt(e)
		}
		return a
	};
	Gradient.StopsHandler = function(c, e) {
		this.gradientEditor = e.gradientEditor;
		this.gradientControl = e.gradientControl;
		this.gradientPanelElem = e.gradientPanelElem;
		this.gradientMarkersContainerElem = e.gradientMarkersContainerElem;
		this.gradientMarkerDeleterElem = e.gradientMarkerDeleterElem;
		this.stopDetailsPanel = e.stopDetailsPanel;
		this.onStopActivatedCallback = e.onStopActivatedCallback;
		this.type = c;
		this.stopDetailsColorPanel = null;
		this.opacityValueElem = null;
		if(this.type == "color") {
			this.stopDetailsColorPanel = this.gradientControl.select(".stop-details .color")[0];
			this.stopDetailsColorPanel.observe("click", this.onStopDetailsColorPanelClick.bind(this))
		} else {
			this.opacityValueElem = this.gradientControl.select(".stop-details .opacity-value")[0];
			this.opacityValueElem.observe("keyup", this.onOpacityDetailsEntryBoxKeyUp.bind(this));
			this.opacityValueElem.observe("keydown", this.onOpacityDetailsEntryBoxKeyDown.bind(this));
			this.opacityValueElem.observe("blur", this.onOpacityDetailsEntryBoxBlur.bind(this));
			this.opacityAdjustOpenButtonElem = this.gradientControl.select(".stop-details .opacity-adjust-open-button")[0];
			this.opacityAdjustOpenButtonElem.observe("click", this.onOpacityAdjustOpenButtonClick.bind(this))
		}
		this.stopDetailsPositionEntryBox = this.stopDetailsPanel.select(".position")[0];
		this.stopDetailsDeleteButton = this.stopDetailsPanel.select(".delete-button button")[0];
		this.setDisableStopDetailsPanel(true);
		this.onGradientControlMouseUpHandler = this.onGradientControlMouseUp.bind(this);
		this.onGradientControlMouseMoveHandler = this.onGradientControlMouseMove.bind(this);
		this.onStopMarkerDeleterMouseOverHandler = this.onStopMarkerDeleterMouseOver.bind(this);
		this.stopDetailsDeleteButton.observe("click", this.onStopDetailsDeleteButtonClick.bind(this));
		this.stopDetailsPositionEntryBox.observe("keyup", this.onStopDetailsPositionEntryBoxKeyUp.bind(this));
		this.stopDetailsPositionEntryBox.observe("keydown", this.onStopDetailsPositionEntryBoxKeyDown.bind(this));
		this.stopDetailsPositionEntryBox.observe("blur", this.onStopDetailsPositionEntryBoxBlur.bind(this));
		this.gradientMarkersContainerElem.observe("click", this.onGradientMarkersContainerClick.bind(this));
		this.activeStopMarkerElem = null;
		this.draggingStopMarkerElem = null;
		this.opacityStopAdjustContainerElem = null;
		if(this.type == "opacity") {
			this.defaultStops = [
				{opacity: 1, position: "0%"},
				{opacity: 1, position: "100%"},
			];
			this.stops = Gradient.Utils.deepClone(this.defaultStops);
			var d = Gradient.Utils.blankURI;
			this.opacityStopAdjustContainerElem = $$(".opacity-stop-adjust-container")[0];
			this.transparentScreen = $("transparent-screen");
			var a = this.opacityStopAdjustContainerElem.select(".opacity-slider-container")[0];
			var b = this.opacityStopAdjustContainerElem.select(".opacity-slider-bar")[0];
			this.opacityAdjustSlider = new Refresh.Web.Slider(b, {xMinValue: 1, xMaxValue: 100, yMinValue: 1, yMaxValue: 1, arrowImage: d}, a);
			this.onDocumentClickToHideOpacityPanelHandler = this.onDocumentClickToHideOpacityPanel.bind(this);
			this.opacityAdjustSlider.onValuesChanged = this.onOpacityAdjustSliderValueChanged.bind(this)
		}
		this.lastUsedOpacity = 1
	};
	Gradient.StopsHandler.prototype = {
		setStops: function(b, a) {
			this.stops = b;
			this.setActiveStopMakerElemAndUpdateDetailsPanel(null);
			if((typeof a != "undefined") && a) {this.gradientEditor.updateAllUI()}
		},
		getStops: function() {return this.stops}, getStopPositionFromMouseEvent: function(c) {
			var b = Element.cumulativeOffset(this.gradientMarkersContainerElem)[0];
			var d = c - b;
			var a = Math.round((d * 100) / this.gradientEditor.gradientPanelElemWidth);
			a = a + "%";
			return a
		},
		updateStopMarkers: function() {
			var c = this.stops;
			for(var b = 0; b < c.length; b++) {
				var a = this.gradientMarkersContainerElem.select(".stop-marker-" + b);
				if(a.length == 0) {this.createStopMarker(b)}
				this.updateStopMarker(b, this.getStopValue(c[b]), c[b].position)
			}
			this.removeUnusedMarkers()
		},
		updateStopMarker: function(e, c, a) {
			a = parseInt(a);
			var b = this.findStopMarkerElemByIndex(e);
			var d = Math.round(((this.gradientEditor.gradientPanelElemWidth * a) / 100) - 5.5);
			b.style.left = d + "px";
			if(this.type == "color") {
				b.select(".color")[0].style.background = c;
				b.setAttribute("color", c)
			} else {
				b.select(".color")[0].style.background = this.opacityToStopColor(c);
				b.setAttribute("stop-opacity", c)
			}
			b.setAttribute("position", a);
			b.setAttribute("imarker", e)
		},
		removeUnusedMarkers: function() {
			var a = this.gradientMarkersContainerElem.select(".stop-marker");
			for(var c = 0; c < a.length; c++) {
				var b = a[c];
				var d = b.getAttribute("imarker");
				if(d >= this.stops.length) {b.parentNode.removeChild(b)}
			}
		},
		opacityToStopColor: function(a) {
			var b = 255 - Math.round(a * 255);
			return Gradient.Utils.rgbToHexa(b, b, b)
		},
		createStopMarker: function(c) {
			var a = document.createElement("div");
			a.className = "stop-marker stop-marker-" + c;
			var b = document.createElement("div");
			b.className = "color";
			a.appendChild(b);
			this.gradientMarkersContainerElem.appendChild(a);
			Element.extend(a);
			a.observe("mousedown", this.onStopMarkerMouseDown.bind(this));
			a.observe("dblclick", this.onStopMarkerDoubleClick.bind(this));
			a.setAttribute("title", this.type == "color" ? "Color stop" : "Opacity stop")
		},
		setActiveStopMakerElem: function(a) {
			if(this.activeStopMarkerElem) {this.activeStopMarkerElem.removeClassName("active")}
			this.activeStopMarkerElem = a;
			if(this.activeStopMarkerElem) {
				this.activeStopMarkerElem.addClassName("active");
				if(this.type == "color") {
					this.gradientEditor.lastUsedColor = this.activeStopMarkerElem.getAttribute("color")
				} else {
					this.lastUsedOpacity = this.activeStopMarkerElem.getAttribute("stop-opacity")
				}
			}
		},
		setActiveStopMakerElemAndUpdateDetailsPanel: function(b) {
			if(b && this.onStopActivatedCallback) {this.onStopActivatedCallback(this.type)}
			this.setActiveStopMakerElem(b);
			if(b) {
				this.setDisableStopDetailsPanel(false);
				if(this.stopDetailsColorPanel) {
					this.stopDetailsColorPanel.style.background = b.getAttribute("color");
					this.stopDetailsPositionEntryBox.focus()
				} else {
					if(this.opacityValueElem) {
						var a = b.getAttribute("stop-opacity");
						this.opacityValueElem.value = Math.round(a * 100);
						this.opacityValueElem.select();
						this.opacityValueElem.focus()
					}
				}
				this.stopDetailsPositionEntryBox.value = b.getAttribute("position");
				if(this.type == "color") {this.stopDetailsPositionEntryBox.select()}
			} else {this.setDisableStopDetailsPanel(true)}
		},
		getActiveStopMarkerElemIndex: function() {
			if(this.activeStopMarkerElem) {
				return this.activeStopMarkerElem.getAttribute("imarker")
			} else {return null}
		},
		getDraggingStopMarkerElemIndex: function() {
			if(this.draggingStopMarkerElem) {
				return this.draggingStopMarkerElem.getAttribute("imarker")
			} else {return null}
		},
		deleteStop: function(c) {
			this.gradientEditor.invalidateCurrentPreset();
			var a = this.findStopMarkerElemByIndex(c);
			a.parentNode.removeChild(a);
			var d = [];
			for(var b = 0; b < this.stops.length; b++) {if(b != c) {d.push(this.stops[b])}}
			this.setStops(d, true);
			this.setActiveStopMakerElemAndUpdateDetailsPanel(null)
		},
		sortStopsByPosition: function() {
			function a(e, c) {
				var d = parseInt(e.position);
				var f = parseInt(c.position);
				return d - f
			}

			this.stops.sort(a)
		},
		getStopValue: function(a) {return(this.type == "color") ? a.color : a.opacity}, findStopIndexByPositionAndValue: function(d, c) {
			d = parseInt(d);
			for(var b = 0; b < this.stops.length; b++) {
				var a = this.getStopValue(this.stops[b]);
				if((parseInt(this.stops[b].position) == d) && (a == c)) {return b}
			}
			return null
		},
		findStopMarkerElemByIndex: function(a) {return this.gradientMarkersContainerElem.select(".stop-marker-" + a)[0]}, changeActiveStopValue: function(a) {
			var b = this.getActiveStopMarkerElemIndex();
			if(b === null) {return}
			if(this.stopDetailsColorPanel) {this.stopDetailsColorPanel.style.background = a} else {if(this.opacityValueElem) {}}
			if(this.type == "color") {this.stops[b].color = a} else {this.stops[b].opacity = a}
			this.gradientEditor.updateAllUI()
		},
		updateStopPosition: function(b, a) {
			this.stops[b].position = a;
			var c = this.getStopValue(this.stops[b]);
			this.sortStopsByPosition();
			this.gradientEditor.invalidateCurrentPreset();
			this.gradientEditor.updateAllUI();
			var e = this.findStopIndexByPositionAndValue(a, c);
			var d = this.findStopMarkerElemByIndex(e);
			this.setActiveStopMakerElem(d);
			if(this.draggingStopMarkerElem) {this.draggingStopMarkerElem = d}
		},
		setDisableStopDetailsPanel: function(a) {
			if(a) {
				this.stopDetailsPanel.addClassName("disabled");
				this.stopDetailsPositionEntryBox.value = "";
				this.stopDetailsPositionEntryBox.setAttribute("disabled", "true");
				this.stopDetailsDeleteButton.setAttribute("disabled", "true");
				if(this.stopDetailsColorPanel) {
					this.stopDetailsColorPanel.style.background = "#efefef"
				} else if(this.opacityValueElem) {
					this.opacityValueElem.value = "";
					this.opacityValueElem.setAttribute("disabled", "true");
					this.opacityAdjustOpenButtonElem.addClassName("disabled")
				}
			} else {
				this.stopDetailsPanel.removeClassName("disabled");
				this.stopDetailsPositionEntryBox.removeAttribute("disabled");
				if(this.stops.length > 2) {
					this.stopDetailsDeleteButton.removeAttribute("disabled")
				} else {
					this.stopDetailsDeleteButton.setAttribute("disabled", "true")
				}
				if(this.opacityValueElem) {
					this.opacityValueElem.removeAttribute("disabled");
					this.opacityAdjustOpenButtonElem.removeClassName("disabled")
				}
			}
		},
		showOpacityStopAdjustPanel: function(a, d, b) {
			this.transparentScreen.show();
			var c = $$("body")[0].getHeight();
			this.transparentScreen.style.height = c + "px";
			this.opacityStopAdjustContainerElem.show();
			this.opacityStopAdjustContainerElem.style.left = a + "px";
			this.opacityStopAdjustContainerElem.style.top = d + "px";
			this.opacityAdjustSlider.xValue = Math.round(b * 100);
			this.opacityAdjustSlider.setArrowPositionFromValues();
			document.observe("mousedown", this.onDocumentClickToHideOpacityPanelHandler)
		},
		hideOpacityStopAdjustPanel: function() {
			this.transparentScreen.hide();
			this.opacityStopAdjustContainerElem.hide();
			document.stopObserving("mousedown", this.onDocumentClickToHideOpacityPanelHandler)
		},
		opacityStopAdjustPanelIsVisible: function() {return this.opacityStopAdjustContainerElem && this.opacityStopAdjustContainerElem.visible()},
		registerDraggingEvents: function() {
			this.gradientControl.observe("mouseup", this.onGradientControlMouseUpHandler);
			this.gradientControl.observe("mousemove", this.onGradientControlMouseMoveHandler);
			this.gradientMarkerDeleterElem.observe("mouseover", this.onStopMarkerDeleterMouseOverHandler);
			this.gradientPanelElem.observe("mouseover", this.onStopMarkerDeleterMouseOverHandler)
		},
		unregisterDraggingEvents: function() {
			this.gradientControl.stopObserving("mouseup", this.onGradientControlMouseUpHandler);
			this.gradientControl.stopObserving("mousemove", this.onGradientControlMouseMoveHandler);
			this.gradientMarkerDeleterElem.stopObserving("mouseover", this.onStopMarkerDeleterMouseOverHandler);
			this.gradientPanelElem.stopObserving("mouseover", this.onStopMarkerDeleterMouseOverHandler)
		},
		onStopMarkerMouseDown: function(b) {
			Event.stop(b);
			var a = Event.element(b);
			if(!a.hasClassName("stop-marker")) {a = a.up(".stop-marker")}
			this.setActiveStopMakerElemAndUpdateDetailsPanel(a);
			this.draggingStopMarkerElem = a;
			this.registerDraggingEvents()
		},
		onGradientControlMouseUp: function(a) {
			this.draggingStopMarkerElem = null;
			this.unregisterDraggingEvents();
			if(this.type == "color") {this.stopDetailsPositionEntryBox.select()}
		},
		onGradientControlMouseMove: function(c) {
			if(!this.draggingStopMarkerElem) {return}
			Event.stop(c);
			var d = Event.pointerX(c);
			var b = this.getStopPositionFromMouseEvent(d);
			var a = parseInt(b);
			if((a < 0) || (a > 100)) {return}
			var e = this.getDraggingStopMarkerElemIndex();
			this.updateStopPosition(e, b);
			this.stopDetailsPositionEntryBox.value = parseInt(b)
		},
		onStopMarkerDeleterMouseOver: function(b) {
			var a = Event.element(b);
			if(this.draggingStopMarkerElem) {
				if(this.stops.length > 2) {
					var c = this.getDraggingStopMarkerElemIndex();
					this.deleteStop(c)
				}
				this.draggingStopMarkerElem = null;
				this.unregisterDraggingEvents()
			}
		},
		onStopDetailsDeleteButtonClick: function(a) {
			if(this.activeStopMarkerElem) {
				if(this.stops.length > 2) {
					var b = this.getActiveStopMarkerElemIndex();
					this.deleteStop(b)
				}
				this.setActiveStopMakerElemAndUpdateDetailsPanel(null)
			}
		},
		handleStopDetailsPositionEntryBoxKeyEvent: function(b) {
			var c = parseInt(b.value);
			if(isNaN(c)) {return}
			if(c < 0) {c = 0}
			if(c > 100) {c = 100}
			b.value = c;
			if(this.activeStopMarkerElem) {
				var d = this.getActiveStopMarkerElemIndex();
				var a = c;
				this.updateStopPosition(d, a + "%")
			}
		},
		onStopDetailsPositionEntryBoxKeyUp: function(b) {
			var a = Event.element(b);
			this.handleStopDetailsPositionEntryBoxKeyEvent(a)
		},
		onStopDetailsPositionEntryBoxKeyDown: function(c) {
			var a = Event.element(c);
			var e = parseInt(a.value);
			if(isNaN(e)) {return}
			var d = 38;
			var b = 40;
			var f = c.keyCode;
			if(f == d) {e++}
			if(f == b) {e--}
			a.value = e;
			this.handleStopDetailsPositionEntryBoxKeyEvent(a)
		},
		onStopDetailsPositionEntryBoxBlur: function(b) {
			var a = Event.element(b);
			var d = parseInt(a.value);
			if(isNaN(d) && this.activeStopMarkerElem) {
				var e = this.getActiveStopMarkerElemIndex();
				var c = this.stops[e].position;
				a.value = parseInt(c)
			}
		},
		handleOpacityDetailsEntryBoxKeyEvent: function(a) {
			var b = parseInt(a.value);
			if(isNaN(b)) {return}
			if(b < 0) {b = 0}
			if(b > 100) {b = 100}
			a.value = b;
			if(this.activeStopMarkerElem) {
				var c = b / 100;
				this.changeActiveStopValue(c);
				this.lastUsedOpacity = c
			}
		},
		onOpacityDetailsEntryBoxKeyUp: function(b) {
			var a = Event.element(b);
			this.handleOpacityDetailsEntryBoxKeyEvent(a)
		},
		onOpacityDetailsEntryBoxKeyDown: function(c) {
			var a = Event.element(c);
			var a = Event.element(c);
			var e = parseInt(a.value);
			if(isNaN(e)) {return}
			var d = 38;
			var b = 40;
			var f = c.keyCode;
			if(f == d) {e++}
			if(f == b) {e--}
			a.value = e;
			this.handleOpacityDetailsEntryBoxKeyEvent(a)
		},
		onOpacityDetailsEntryBoxBlur: function(c) {
			var b = Event.element(c);
			var d = parseInt(b.value);
			if(isNaN(d) && this.activeStopMarkerElem) {
				var e = this.getActiveStopMarkerElemIndex();
				var a = this.stops[e].opacity;
				b.value = Math.round(a * 100)
			}
		},
		onStopDetailsColorPanelClick: function(c) {
			if(!this.activeStopMarkerElem) {return}
			var a = Event.element(c);
			var d = Event.pointerX(c);
			var b = Event.pointerY(c);
			this.gradientEditor.openColorPicker(d, b)
		},
		onStopMarkerDoubleClick: function(b) {
			var a = Event.element(b);
			if(this.type == "color") {
				this.gradientEditor.openColorPicker()
			} else {
				var c = a.cumulativeOffset();
				this.showOpacityStopAdjustPanel(c[0] + 6, c[1] - 35, this.lastUsedOpacity)
			}
		},
		onOpacityAdjustOpenButtonClick: function(b) {
			if(!this.activeStopMarkerElem) {return}
			var a = Event.element(b);
			var c = a.cumulativeOffset();
			this.showOpacityStopAdjustPanel(c[0] + 10, c[1] - 10, this.lastUsedOpacity)
		},
		onDocumentClickToHideOpacityPanel: function(b) {
			if(!this.opacityStopAdjustPanelIsVisible()) {return}
			Event.stop(b);
			var a = Event.element(b);
			if(a.hasClassName("opacity-stop-adjust-container") || a.up(".opacity-stop-adjust-container")) {return}
			this.hideOpacityStopAdjustPanel()
		},
		onOpacityAdjustSliderValueChanged: function() {
			var a = this.opacityAdjustSlider.xValue;
			var b = a / 100;
			if(this.activeStopMarkerElem) {
				this.changeActiveStopValue(b);
				this.lastUsedOpacity = b;
				this.opacityValueElem.value = a
			}
		},
		onGradientMarkersContainerClick: function(d) {
			var c = Event.element(d);
			if(c != this.gradientMarkersContainerElem) {return}
			var f = Event.pointerX(d);
			var a = this.getStopPositionFromMouseEvent(f);
			var g;
			var b;
			if(this.type == "color") {
				g = this.gradientEditor.lastUsedColor;
				b = {color: g, position: a}
			} else {
				g = this.lastUsedOpacity;
				b = {opacity: g, position: a}
			}
			this.stops.push(b);
			this.sortStopsByPosition();
			this.gradientEditor.updateAllUI();
			var h = this.findStopIndexByPositionAndValue(a, g);
			var e = this.findStopMarkerElemByIndex(h);
			this.setActiveStopMakerElemAndUpdateDetailsPanel(e)
		}
	};
	Gradient.StopUtils = {
		interpolateStopsProperty: function(n, m, r, b) {
			var d = parseInt(n.position), l = parseInt(m.position), g = r,
				i = l - d, j = g - d, f = j / i, a = 1 - f;
			if(b == "color") {
				var p = Gradient.Utils.hexaToRGB(n.color),
					c = Gradient.Utils.hexaToRGB(m.color),
					e = Math.round(p.red * a + c.red * f),
					h = Math.round(p.green * a + c.green * f),
					k = Math.round(p.blue * a + c.blue * f);
				return{red: e, green: h, blue: k}
			} else {
				var q = n.opacity;
				var o = m.opacity;
				return Math.round((q * a + o * f) * 100) / 100
			}
		},
		interpolateStopsColor: function(e, c, b, d) {
			var a = Gradient.StopUtils.interpolateStopsProperty(e, c, b, "color");
			if((typeof d === "undefined") || (d == "hex")) {return Gradient.Utils.rgbToHexa(a.red, a.green, a.blue)}
			return a
		},
		interpolateStopsOpacity: function(c, b, a) {return Gradient.StopUtils.interpolateStopsProperty(c, b, a, "opacity")},
		getColorForOpacityOnlyStop: function(k, f, b, c) {
			var e = k;
			var a = null;
			for(var d = e + 1; d < f.length; d++) {
				if("color" in b[f[d]]) {
					a = b[f[d]];
					break
				}
			}
			var g = null;
			for(var d = e - 1; d >= 0; d--) {
				if("color" in b[f[d]]) {
					g = b[f[d]];
					break
				}
			}
			if(!g) {g = a}
			if(!a) {a = g}
			var h = g.color;
			if(g != a) {h = Gradient.StopUtils.interpolateStopsColor(g, a, parseInt(f[k]), c)}
			return h
		},
		getOpacityForColorOnlyStop: function(h, c, g) {
			var e = h;
			var b = null;
			for(var d = e + 1; d < c.length; d++) {
				if("opacity" in g[c[d]]) {
					b = g[c[d]];
					break
				}
			}
			var a = null;
			for(var d = e - 1; d >= 0; d--) {
				if("opacity" in g[c[d]]) {
					a = g[c[d]];
					break
				}
			}
			if(!a) {a = b}
			if(!b) {b = a}
			var f = a.opacity;
			if(a != b) {var f = Gradient.StopUtils.interpolateStopsOpacity(a, b, parseInt(c[h]))}
			return f
		},
		mergeStops: function(d, c) {
			var k = Gradient.Utils.deepClone(d);
			var g = Gradient.Utils.deepClone(c);
			k = k.concat(g);
			function a(n, i) {
				var m = parseInt(n.position);
				var o = parseInt(i.position);
				return m - o
			}

			k.sort(a);
			var f = [];
			var b = {};
			for(var e = 0; e < k.length; e++) {
				var j = k[e], h = j.position;
				if(!(h in b)) {
					f.push(h);
					b[h] = {position: h}
				}
				if("color" in j) {b[h].color = j.color}
				if("opacity" in j) {b[h].opacity = j.opacity}
			}
			var l = [];
			for(var e = 0; e < f.length; e++) {
				var j = b[f[e]];
				if(!("color" in j)) {j.color = Gradient.StopUtils.getColorForOpacityOnlyStop(e, f, b, "hex")}
				if(!("opacity" in j)) {j.opacity = Gradient.StopUtils.getOpacityForColorOnlyStop(e, f, b)}
				l.push(j)
			}
			return l
		},
		extractStopByType: function(a, b) {
			if(b == "color") {
				return{position: a.position, color: a.color}
			} else if(b == "opacity") {
				return{position: a.position, opacity: a.opacity}
			}
			return null
		},
		splitStopsIntoColorAndOpacity: function(k) {
			var m = k.stops;
			if(m.length < 2) {return null}
			var a = [], e = [];
			for(var c = 1; c < m.length - 1; c++) {
				var j = m[c], f = m[c - 1], l = m[c + 1], b = Gradient.Utils.hexaToRGB(j.color),
					n = Gradient.StopUtils.interpolateStopsColor(f, l, parseInt(j.position), "rgb"),
					o = n.red, d = n.green, g = n.blue, h = Gradient.StopUtils.interpolateStopsOpacity(f, l, parseInt(j.position));
				if((Math.abs(o - b.red) > 1) || (Math.abs(d - b.green) > 1) || (Math.abs(g - b.blue) > 1)) {a.push(Gradient.StopUtils.extractStopByType(j, "color"))}
				if(Math.abs(h - (Math.round(j.opacity * 100) / 100)) > 0.05) {e.push(Gradient.StopUtils.extractStopByType(j, "opacity"))}
			}
			if(a.length == 0) {a = [Gradient.StopUtils.extractStopByType(m[0], "color"), Gradient.StopUtils.extractStopByType(m[m.length - 1], "color")]} else {
				if(m[0].color != a[0].color) {a.unshift(Gradient.StopUtils.extractStopByType(m[0], "color"))}
				if(m[m.length - 1].color != a[a.length - 1].color) {a.push(Gradient.StopUtils.extractStopByType(m[m.length - 1], "color"))}
			}
			if(e.length == 0) {e = [Gradient.StopUtils.extractStopByType(m[0], "opacity"), Gradient.StopUtils.extractStopByType(m[m.length - 1], "opacity")]} else {
				if(m[0].opacity != e[0].opacity) {e.unshift(Gradient.StopUtils.extractStopByType(m[0], "opacity"))}
				if(m[m.length - 1].opacity != e[e.length - 1].opacity) {e.push(Gradient.StopUtils.extractStopByType(m[m.length - 1], "opacity"))}
			}
			k.stops = Gradient.Utils.deepClone(a);
			k.opacityStops = Gradient.Utils.deepClone(e);
			return k
		},
		gradientHasOpacity: function(c) {
			if(!c) {return false}
			if(!c.stops) {return false}
			for(var b = 0; b < c.stops.length; b++) {
				var a = c.stops[b];
				if(("opacity" in a) && (a.opacity != 1)) {return true}
			}
			return false
		},
		extractColorOnlyStops: function(b) {
			if(!b) {return}
			if(!b.stops) {return}
			for(var a = 0; a < b.stops.length; a++) {b.stops[a] = Gradient.StopUtils.extractStopByType(b.stops[a], "color")}
			return b
		}
	};
})(this, document);